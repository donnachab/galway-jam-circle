<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galway Jam Circle - Official Website</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Swiper.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --primary-color: #371087; /* Correct Purple */
            --accent-color: #F3EAD3;  /* Warm Cream */
            --background-color: #FFFFFF;
            --text-dark: #1f2937;
            --text-light: #FFFFFF;
        }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--background-color);
            color: var(--text-dark);
        }
        .bg-primary { background-color: var(--primary-color); }
        .text-primary { color: var(--primary-color); }
        .bg-accent { background-color: var(--accent-color); }
        .text-accent { color: var(--accent-color); }
        .border-primary { border-color: var(--primary-color); }
        .admin-controls, .admin-controls-inline { display: none; }
        body.admin-mode .admin-controls { display: block; } 
        body.admin-mode .admin-controls-inline { display: inline-flex; } 
        #add-jam-form, #add-event-form, #add-photo-form, #edit-cover-photo-form, #edit-featured-video-form, #venue-management-section, #add-community-form { display: none; }
        .jam-cancelled { background-color: #fee2e2 !important; }
        .jam-cancelled .jam-info { text-decoration: line-through; }
        .jam-special-day { border-color: #FBBF24 !important; border-width: 2px; } /* Amber for special days */
        .gallery-item { position: relative; }
        .gallery-item .delete-photo-btn { position: absolute; top: 0.5rem; right: 0.5rem; }
        details > summary {
            cursor: pointer;
        }
        /* Festival Carousel Styles */
        .festival-carousel {
            padding-top: 1rem;
            padding-bottom: 3rem; /* Space for pagination */
        }
        .festival-carousel .swiper-slide {
            height: 120px; /* Consistent height for logos */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .festival-carousel .swiper-slide img {
            max-height: 90px;
            width: auto;
            object-fit: contain;
            opacity: 0.9;
            transition: all 0.3s ease;
        }
        .festival-carousel .swiper-slide:hover img {
            opacity: 1;
            transform: scale(1.05);
        }
        .swiper-pagination-bullet-active {
            background-color: var(--primary-color) !important;
        }
        /* Community Slideshow Styles */
        .community-swiper {
            width: 100%;
            border-radius: 0.5rem;
        }
        .community-swiper .swiper-slide {
            position: relative;
        }
        .community-swiper .slide-admin-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 10;
        }
        .community-swiper .swiper-button-next,
        .community-swiper .swiper-button-prev {
            color: var(--accent-color);
            background-color: rgba(0,0,0,0.3);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            --swiper-navigation-size: 22px;
        }
         .community-swiper .swiper-button-next:hover,
        .community-swiper .swiper-button-prev:hover {
             background-color: rgba(0,0,0,0.5);
        }
        .community-swiper .swiper-pagination {
            position: static;
            margin-top: 1rem;
        }
        /* Responsive Image container style */
        .community-image-container {
            width: 100%;
            height: 20rem; /* 320px for mobile */
            background-color: #f0f0f0; /* light gray */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem 0.5rem 0 0;
            overflow: hidden;
        }
        .community-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Default to cover for mobile */
        }
        @media (min-width: 768px) { /* md breakpoint */
            .community-image-container {
                height: 24rem; /* 384px for desktop */
            }
            .community-image-container img {
                object-fit: contain; /* Switch to contain for desktop */
            }
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- HEADER SECTION -->
    <header class="bg-primary shadow-lg sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2 sm:space-x-4">
                <div class="w-12 h-12 sm:w-14 sm:h-14">
                    <img src="images/logo.jpg" alt="Galway Jam Circle Logo" class="rounded-full">
                </div>
                <div class="text-white text-lg sm:text-2xl font-bold tracking-tight">Galway Jam Circle</div>
            </div>
            <div class="hidden md:flex items-center space-x-2">
                <a href="#home" class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300">Home</a>
                <a href="#jams" class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300">Regular Jams</a>
                <a href="#format" class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300">Our Format</a>
                <a href="#special-events" class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300">Festivals & Events</a>
                <a href="#community" class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300">Community</a>
                <a href="#gallery" class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300">Gallery</a>
                <a href="https://drive.google.com/file/d/1V3X3K5hwUHxZtn3o29Wd6ZZ4twz4x0j_/view?usp=sharing" target="_blank" class="text-primary bg-accent px-4 py-3 rounded-md hover:bg-opacity-80 transition duration-300 font-bold">Songbook</a>
                <a href="#contact" class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300">Contact</a>
            </div>
            <div class="md:hidden">
                <button id="menu-btn" class="text-white focus:outline-none"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg></button>
            </div>
        </nav>
        <div id="mobile-menu" class="md:hidden hidden bg-primary/95">
            <a href="#home" class="block text-white text-center py-3 hover:bg-white/10">Home</a>
            <a href="#jams" class="block text-white text-center py-3 hover:bg-white/10">Regular Jams</a>
            <a href="#format" class="block text-white text-center py-3 hover:bg-white/10">Our Format</a>
            <a href="#special-events" class="block text-white text-center py-3 hover:bg-white/10">Festivals & Events</a>
            <a href="#community" class="block text-white text-center py-3 hover:bg-white/10">Community</a>
            <a href="#gallery" class="block text-white text-center py-3 hover:bg-white/10">Gallery</a>
            <a href="https://drive.google.com/file/d/1V3X3K5hwUHxZtn3o29Wd6ZZ4twz4x0j_/view?usp=sharing" target="_blank" class="block text-primary text-center font-bold py-3 bg-accent hover:bg-opacity-80">Songbook</a>
            <a href="#contact" class="block text-white text-center py-3 hover:bg-white/10">Contact</a>
        </div>
    </header>

    <main>
        <section id="home" class="relative text-white text-center">
            <img id="cover-photo" src="https://scontent-dub4-1.xx.fbcdn.net/v/t39.30808-6/340126198_1202888093755813_6375467148998027340_n.jpg?_nc_cat=105&ccb=1-7&_nc_sid=2285d6&_nc_ohc=wA-6pUbx_XYQ7kNvwHkWjV3&_nc_oc=Adnd0Bbs-9bBGiNkVlqTm636JeXERyh16eo2fUrKp5p7sPkeFMlKHcYdyTj8qGDYzQk&_nc_zt=23&_nc_ht=scontent-dub4-1.xx&_nc_gid=Pse2aOVgLI3EOs4_MVhu_Q&oh=00_AfWMKMB5g8K5fFbQO5RjBf8Wp9epHYVIZ5FuDYFFu1qEsg&oe=689D27F9" alt="A group of people playing instruments like guitars and ukuleles by a river in Galway." class="w-full h-[70vh] object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-black/75 to-transparent flex flex-col justify-end items-center p-6 sm:p-12">
                <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-white drop-shadow-2xl">Welcome to the Galway Jam Circle</h1>
                <p class="mt-4 text-lg sm:text-xl max-w-3xl text-white/90 drop-shadow-xl">A friendly, informal music-making community for all skill levels. Let's Jam!</p>
                <div class="mt-8 flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <a href="#jams" class="px-8 py-3 bg-accent text-primary font-bold rounded-full hover:bg-opacity-80 transition duration-300 transform hover:scale-105 shadow-lg">See Regular Jams</a>
                    <div class="flex items-start space-x-4">
                        <div class="text-center">
                            <a href="https://www.facebook.com/groups/116675615376726" target="_blank" class="text-white hover:text-accent transition duration-300">
                                <svg class="w-8 h-8 mx-auto mb-1" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33V21.878A10.001 10.001 0 0022 12z" clip-rule="evenodd" /></svg>
                                <span class="text-xs font-semibold">Group</span>
                            </a>
                        </div>
                        <div class="text-center">
                            <a href="https://www.facebook.com/profile.php?id=61570031297498" target="_blank" class="text-white hover:text-accent transition duration-300">
                                <svg class="w-8 h-8 mx-auto mb-1" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33V21.878A10.001 10.001 0 0022 12z" clip-rule="evenodd" /></svg>
                                <span class="text-xs font-semibold">Page</span>
                            </a>
                        </div>
                        <a href="https://www.instagram.com/galwayjamcircle42/?hl=en" target="_blank" class="text-white hover:text-accent transition duration-300 pt-1">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.024.048-1.378.06-3.808.06s-2.784-.012-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.048-1.024-.06-1.378-.06-3.808s.012-2.784.06-3.808c.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 016.345 2.525c.636-.247 1.363-.416 2.427-.465C9.792 2.013 10.146 2 12.315 2zm0 1.623c-2.403 0-2.748.01-3.728.058-1.006.047-1.634.21-2.203.434a3.272 3.272 0 00-1.15 1.15c-.224.57-.386 1.198-.434 2.203-.048.98-.058 1.325-.058 3.728s.01 2.748.058 3.728c.048 1.006.21 1.634.434 2.203a3.272 3.272 0 001.15 1.15c.57.224 1.198.386 2.203.434.98.048 1.325.058 3.728.058s2.748-.01 3.728-.058c1.006-.047 1.634-.21 2.203-.434a3.272 3.272 0 001.15-1.15c.224-.57.386-1.198.434-2.203.048-.98.058-1.325.058-3.728s-.01-2.748-.058-3.728c-.048-1.006-.21-1.634-.434-2.203a3.272 3.272 0 00-1.15-1.15c-.57-.224-1.198-.386-2.203-.434C15.063 3.633 14.718 3.623 12.315 3.623zM12 9.75a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5zm0 6a3.75 3.75 0 110-7.5 3.75 3.75 0 010 7.5zM16.965 6.57a1.125 1.125 0 100 2.25 1.125 1.125 0 000-2.25z" clip-rule="evenodd" /></svg>
                        </a>
                    </div>
                </div>
            </div>
        </section>
        
        <div class="container mx-auto px-4 sm:px-6 text-center -mt-8 relative z-10">
            <div class="admin-controls-inline items-center justify-center">
                <button id="edit-cover-photo-btn" class="px-4 py-2 bg-blue-500 text-white font-bold rounded-full hover:bg-blue-600 transition duration-300 shadow-md">Change Cover Photo</button>
                <button class="exit-admin-btn px-4 py-2 bg-red-600 text-white font-bold rounded-full hover:bg-red-700 transition duration-300 shadow-md ml-4">Exit Admin Mode</button>
            </div>
            <form id="edit-cover-photo-form" class="max-w-xl mx-auto mt-4 p-6 bg-white rounded-lg shadow-xl border border-gray-200">
                <h3 class="text-xl font-bold text-primary mb-4">Change Cover Photo</h3>
                <div class="mb-4">
                    <label for="cover-photo-url" class="block text-gray-700 font-bold mb-2 text-left">New Photo URL</label>
                    <input type="url" id="cover-photo-url" class="w-full p-2 border rounded" placeholder="Paste direct image link...">
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancel-cover-photo-btn" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90">Save Photo</button>
                </div>
            </form>
        </div>

        <section id="jams" class="py-16 md:py-20 lg:py-24 bg-white">
            <div class="container mx-auto px-4 sm:px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-primary mb-4">Regular Jams</h2>
                    <p class="text-lg text-gray-600 max-w-3xl mx-auto">Our weekly jam schedule. Voluntary donations are welcome to help cover venue costs.</p>
                    
                    <div class="mt-8">
                        <a href="#" onclick="return false;" class="px-8 py-3 bg-accent text-primary font-bold rounded-full transition duration-300 shadow-lg opacity-60 cursor-not-allowed">
                            Contribute €5 for the Jam
                        </a>
                        <p class="text-sm text-gray-500 mt-2 font-semibold">(Payment feature coming soon - for demonstration only)</p>
                    </div>

                </div>
                <div class="max-w-4xl mx-auto">
                    <ul id="jam-list" class="space-y-4"></ul>
                    <div class="text-center mt-8 admin-controls-inline flex-wrap justify-center gap-4">
                        <button id="add-jam-btn" class="px-6 py-2 bg-green-500 text-white font-bold rounded-full hover:bg-green-600 transition duration-300 shadow-md">Add New Jam</button>
                        <button id="manage-venues-btn" class="px-6 py-2 bg-blue-500 text-white font-bold rounded-full hover:bg-blue-600 transition duration-300 shadow-md">Manage Venues</button>
                        <button class="exit-admin-btn px-4 py-2 bg-red-600 text-white font-bold rounded-full hover:bg-red-700 transition duration-300 shadow-md">Exit Admin Mode</button>
                    </div>
                    <form id="add-jam-form" class="mt-8 p-6 bg-gray-50/50 rounded-lg shadow-inner border"><h3 id="form-title" class="text-xl font-bold text-primary mb-4">Add/Edit Jam</h3><input type="hidden" id="edit-jam-id"><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"><div class="md:col-span-2"><label for="jam-date" class="block text-gray-700 font-bold mb-2 text-left">Date</label><input type="text" id="jam-date" class="w-full p-2 border rounded" placeholder="Select a date..."></div><div><label for="jam-day" class="block text-gray-700 font-bold mb-2 text-left">Day</label><input type="text" id="jam-day" class="w-full p-2 border rounded bg-gray-200" readonly></div></div><div class="mb-4"><label for="jam-time" class="block text-gray-700 font-bold mb-2 text-left">Time</label><input type="text" id="jam-time" class="w-full p-2 border rounded" placeholder="Select a time..."></div><div class="mb-4"><label for="jam-venue" class="block text-gray-700 font-bold mb-2 text-left">Venue</label><select id="jam-venue" class="w-full p-2 border rounded"></select></div><div class="mb-4"><label for="jam-map-link" class="block text-gray-700 font-bold mb-2 text-left">Google Maps Link (Optional)</label><input type="url" id="jam-map-link" class="w-full p-2 border rounded" placeholder="Paste Google Maps share link..."></div><div class="flex justify-end space-x-4"><button type="button" id="cancel-btn" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Exit</button><button type="submit" id="submit-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90">Save Jam</button></div></form>
                    <div id="venue-management-section" class="mt-8 p-6 bg-gray-50/50 rounded-lg shadow-inner border">
                        <h3 class="text-xl font-bold text-primary mb-4">Manage Venues</h3>
                        <ul id="venue-list-admin" class="space-y-2 mb-4"></ul>
                        <form id="add-venue-form">
                            <h4 class="text-lg font-bold text-primary mb-2">Add New Venue</h4>
                            <div class="mb-2"><input type="text" id="new-venue-name" class="w-full p-2 border rounded" placeholder="Venue Name"></div>
                            <div class="mb-2"><input type="url" id="new-venue-map-link" class="w-full p-2 border rounded" placeholder="Google Maps Link"></div>
                            <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">Add Venue</button>
                        </form>
                    </div>
                    <div class="admin-controls mt-8 border-t pt-6 border-gray-200"><div class="w-full"><h4 class="text-lg font-bold text-gray-700 mb-2">Date Testing Module</h4><p class="text-sm text-gray-600 mb-2">See how the list will look on a specific date.</p><div class="flex space-x-2"><input type="text" id="test-date-input" class="w-full p-2 border rounded" placeholder="Select a test date..."><button id="test-date-btn" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 whitespace-nowrap">Test Date</button><button id="reset-date-btn" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Reset</button></div></div></div>
                </div>
            </div>
        </section>

        <section id="format" class="py-16 md:py-20 lg:py-24 bg-stone-50 border-t border-stone-200"><div class="container mx-auto px-4 sm:px-6">
            <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-primary mb-12">Our Jam Format</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center max-w-7xl mx-auto">
                <div class="bg-white p-8 rounded-lg shadow-sm border border-stone-200"><h3 class="font-bold text-xl text-primary mb-2">1. Loop Songs First</h3><p class="text-gray-600">We begin with easy, repetitive songs to get everyone warmed up and in the groove.</p></div>
                <div class="bg-white p-8 rounded-lg shadow-sm border border-stone-200"><h3 class="font-bold text-xl text-primary mb-2">2. Four Chords or Less</h3><p class="text-gray-600">Next, we move to songs that use four simple chords or fewer, making it easy for everyone to join in.</p></div>
                <div class="bg-white p-8 rounded-lg shadow-sm border border-stone-200"><h3 class="font-bold text-xl text-primary mb-2">3. Then Anything Goes!</h3><p class="text-gray-600">In the final part of the jam, the floor is open! Bring out any song you'd like to play with the group.</p></div>
            </div>
            <div class="max-w-4xl mx-auto mt-12">
                <details class="p-4 rounded-lg bg-white border border-stone-200">
                    <summary class="font-bold text-lg text-primary">Jamming Guidelines</summary>
                    <div class="mt-4 space-y-4 text-gray-700 text-left prose max-w-none">
                        <p class="italic">"Jamming's where the magic happens"</p>
                        <p>Jam circles are relaxed, open, inclusive gatherings of musicians and singers who sit in a circle facing each other. Jammers play for enjoyment rather than for audiences, but listeners are welcome.</p>
                        <p>A jam is a safe space to learn and grow jamming skills.</p>
                        <p>Jams are acoustic. Instruments such as bass and keyboards are exceptions.</p>
                        <p>The most important skill that each Jammer brings to a jam is their ability to listen.</p>
                        <p>Jammers play and harmonise during songs at a volume that allows singers and soloists to be heard. If you can’t hear the singer/soloist, reduce your volume.</p>
                        <p>The jam circle flows in a clockwise direction.</p>
                        <p>Jammers take turns to Play, Pass, or Pick.</p>
                        <ul class="list-disc list-inside">
                            <li><strong>Play</strong> means to play a song.</li>
                            <li><strong>Pass</strong> means pass to the next jammer.</li>
                            <li><strong>Pick</strong> means pick a song that another jammer plays.</li>
                        </ul>
                        <p>To keep the circle moving, Jammers ideally need to make their choice in advance.</p>
                        <p>To respect the singer, Jammers avoid talking or joining/leaving the circle mid-song.</p>
                        <p>When joining the circle, Jammers wait for their turn to play, pass or pick, unless offered a turn.</p>
                        <p>Jam songs are “Jammable” i.e. they are fun, easy to play- typically 3-4 chords, ideally in the same key.</p>
                        <p>A key feature of jam circles are solos or breaks -- where one Jammer improvises a melody, for approximately a verse and/or chorus.</p>
                        <p>Only one instrument solos at a time and Jammers don’t solo over the singer.</p>
                        <p>Seasoned Jammers encourage less experienced to solo, giving them ‘space to grow’.</p>
                        <p>The singer is the song leader. Jammers need to listen when singers describe the song. Singers name the song, choose the song key, its tempo, and during the song, they invite musicians to solo and/or sing.</p>
                        <p>Any Jammer wishing to take a solo should make eye contact with the singer, indicating their willingness to take a solo. They start to solo when the singer gives them ‘the nod’.</p>
                        <p>The soloist stops the solo after a verse and/or a chorus, attending to the singer’s signals.</p>
                        <p>The singer signals when the song is about to end, commonly by lifting their instrument slightly, or raising a leg, or saying, “one more time”.</p>
                        <p>Jammers tune quietly where possible, and avoid ‘noodling’ between or during songs.</p>
                        <p>When two or more bassists or percussionists are present, they collaborate and/or alternate playing songs, using simple beats and bass lines.</p>
                        <p>Please consider buying a drink if jam venues are provided free.</p>
                        <p>Galway Jam Circle supports jamming for everyone, irrespective of their age, ethnicity, culture, gender identity, religion, language, sexual orientation, ability, disability or social circumstances.</p>
                        <p>We use video and photography at our jam sessions and at performances for social media. If you are uncomfortable with this at a jam, please feel free to ask that you are not filmed/photographed. At performances, please be advised that we have no control over what audience members record.</p>
                    </div>
                </details>
            </div>
            <div class="mt-12 text-center bg-accent/30 p-8 rounded-lg max-w-4xl mx-auto border border-amber-200">
                <img src="images/lets_jam_logo.png" alt="Let's Jam Ireland Logo Placeholder" class="mx-auto mb-4 rounded-md h-20">
                <p class="text-gray-700">Fuller information about the format and rules will be made available on the Let's Jam Ireland site when it is up and running.</p>
            </div>
        </div>
        </section>

        <section id="special-events" class="py-16 md:py-20 lg:py-24 bg-stone-50 border-y border-stone-200">
            <div class="container mx-auto px-4 sm:px-6">
                <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-primary mb-4">Festivals & Special Events</h2>
                <p class="text-center text-lg text-gray-600 max-w-4xl mx-auto mb-12">We love taking part in festivals around Ireland. Here are some of our favourites we've been to, and hope to see again!</p>
                
                <div class="swiper festival-carousel">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide"><img src="images/cleggan-fringe-festival.jpg" alt="Cleggan Fringe Festival Logo"></div>
                        <div class="swiper-slide"><img src="images/doolin-folkfest-2025.png" alt="Doolin FolkFest Logo"></div>
                        <div class="swiper-slide"><img src="images/galway-folk-festival.png" alt="Galway Folk Festival Logo"></div>
                        <div class="swiper-slide"><img src="images/westport-folk-and-bluegrass-festival.jpg" alt="Westport Folk and Bluegrass Festival Logo"></div>
                        <div class="swiper-slide"><img src="images/cahersiveen-mountain-roots.jpg" alt="Cahersiveen Mountain Roots Music Weekend Logo"></div>
                    </div>
                    <div class="swiper-pagination"></div>
                </div>

                <div id="event-list" class="max-w-4xl mx-auto space-y-8 mt-12"></div>
                <div class="text-center mt-8 admin-controls-inline"><button id="add-event-btn" class="px-6 py-2 bg-green-500 text-white font-bold rounded-full hover:bg-green-600 transition duration-300 shadow-md">Add New Event</button></div>
                <form id="add-event-form" class="max-w-4xl mx-auto mt-8 p-6 bg-white rounded-lg shadow-inner border">
                    <h3 id="event-form-title" class="text-xl font-bold text-primary mb-4">Add a New Event</h3>
                    <input type="hidden" id="edit-event-id">
                    <div class="mb-4">
                        <label for="event-title" class="block text-gray-700 font-bold mb-2 text-left">Title</label>
                        <input type="text" id="event-title" class="w-full p-2 border rounded" placeholder="e.g., Cleggan Fringe Festival">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="event-dates" class="block text-gray-700 font-bold mb-2 text-left">Date(s)</label>
                            <input type="text" id="event-dates" class="w-full p-2 border rounded" placeholder="Select a date or date range...">
                        </div>
                        <div>
                            <label for="event-time" class="block text-gray-700 font-bold mb-2 text-left">Time (Optional)</label>
                            <input type="text" id="event-time" class="w-full p-2 border rounded" placeholder="e.g., 6:00 PM - 8:00 PM">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="event-description" class="block text-gray-700 font-bold mb-2 text-left">Description</label>
                        <textarea id="event-description" class="w-full p-2 border rounded" rows="4" placeholder="Enter event details..."></textarea>
                    </div>
                    <div class="flex justify-end space-x-4">
                        <button type="button" id="cancel-event-btn" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Cancel</button>
                        <button type="submit" id="submit-event-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90">Save Event</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Community & Charity Section -->
        <section id="community" class="py-16 md:py-20 lg:py-24 bg-white">
            <div class="container mx-auto px-4 sm:px-6">
                <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-primary mb-4">Community & Charity</h2>
                <p class="text-center text-lg text-gray-600 max-w-4xl mx-auto mb-12">We're proud to be part of the Galway community and support local causes. Here are some of the events and fundraisers we've been involved with.</p>
                
                <div id="community-slider-container" class="max-w-5xl mx-auto">
                    <!-- Swiper -->
                    <div class="swiper community-swiper">
                        <div class="swiper-wrapper" id="community-swiper-wrapper">
                            <!-- Slides will be injected here by JavaScript -->
                        </div>
                        <!-- Add Navigation -->
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                        <!-- Add Pagination -->
                        <div class="swiper-pagination"></div>
                    </div>
                </div>

                <div class="text-center mt-8 admin-controls-inline">
                    <button id="add-community-item-btn" class="px-6 py-2 bg-green-500 text-white font-bold rounded-full hover:bg-green-600 transition duration-300 shadow-md">Add New Item</button>
                </div>

                <form id="add-community-form" class="max-w-3xl mx-auto mt-8 p-6 bg-gray-50/50 rounded-lg shadow-inner border">
                    <h3 id="community-form-title" class="text-xl font-bold text-primary mb-4">Add New Community/Charity Item</h3>
                    <input type="hidden" id="edit-community-id">
                    <div class="mb-4">
                        <label for="community-image-url" class="block text-gray-700 font-bold mb-2 text-left">Image URL</label>
                        <input type="url" id="community-image-url" class="w-full p-2 border rounded" placeholder="Paste direct image link..." required>
                    </div>
                    <div class="mb-4">
                        <label for="community-item-type" class="block text-gray-700 font-bold mb-2 text-left">Item Type</label>
                        <select id="community-item-type" class="w-full p-2 border rounded">
                            <option value="community">Community Event</option>
                            <option value="charity">Charity Fundraiser</option>
                        </select>
                    </div>
                    
                    <!-- Conditional Fields -->
                    <div id="community-headline-wrapper" class="mb-4 hidden">
                        <label for="community-headline" class="block text-gray-700 font-bold mb-2 text-left">Headline</label>
                        <input type="text" id="community-headline" class="w-full p-2 border rounded" placeholder="e.g., Music for the Community Fair">
                    </div>
                    <div id="charity-fields-wrapper" class="hidden">
                        <div class="mb-4">
                            <label for="community-amount" class="block text-gray-700 font-bold mb-2 text-left">Amount Raised</label>
                            <input type="text" id="community-amount" class="w-full p-2 border rounded" placeholder="e.g., €1,200">
                        </div>
                        <div class="mb-4">
                            <label for="community-charity-name" class="block text-gray-700 font-bold mb-2 text-left">For (Charity Name)</label>
                            <input type="text" id="community-charity-name" class="w-full p-2 border rounded" placeholder="e.g., COPE Galway">
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="community-description" class="block text-gray-700 font-bold mb-2 text-left">Description (max 40 words)</label>
                        <textarea id="community-description" class="w-full p-2 border rounded" rows="3" placeholder="A short description of the event or fundraiser..." maxlength="240"></textarea>
                    </div>

                    <div class="flex justify-end space-x-4">
                        <button type="button" id="cancel-community-btn" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90">Save Item</button>
                    </div>
                </form>
            </div>
        </section>
        
        <section id="gallery" class="py-16 md:py-20 lg:py-24 bg-white border-y border-stone-200">
            <div class="container mx-auto px-4 sm:px-6">
                <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-primary mb-12">Jam Circle Gallery</h2>
                
                <h3 class="text-2xl md:text-3xl font-bold text-center text-primary mb-8">Videos</h3>
                <div class="max-w-5xl mx-auto">
                    <div class="relative" style="padding-bottom: 56.25%; height: 0;">
                        <iframe id="featured-video-player" class="absolute top-0 left-0 w-full h-full rounded-lg shadow-lg" src="" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                </div>
                <div class="text-center mt-8 admin-controls-inline">
                    <button id="edit-featured-video-btn" class="px-4 py-2 bg-blue-500 text-white font-bold rounded-full hover:bg-blue-600 transition duration-300 shadow-md">Change Featured Video</button>
                </div>
                      <div class="text-center mt-8">
                     <a href="https://youtube.com/playlist?list=PLG9xaR5hTnatoLYd337wPFrbVkjHmWErw" target="_blank" class="inline-block px-8 py-3 bg-accent text-primary font-bold rounded-full hover:bg-opacity-80 transition duration-300 shadow-md">
                            See our YouTube Channel
                        </a>
                </div>
                <form id="edit-featured-video-form" class="max-w-xl mx-auto mt-4 p-6 bg-white rounded-lg shadow-xl border border-gray-200">
                    <h3 class="text-xl font-bold text-primary mb-4">Change Featured Video</h3>
                    <div class="mb-4">
                        <label for="featured-video-url" class="block text-gray-700 font-bold mb-2 text-left">New YouTube Video URL</label>
                        <input type="url" id="featured-video-url" class="w-full p-2 border rounded" placeholder="Paste YouTube video link...">
                    </div>
                    <div class="flex justify-end space-x-4">
                        <button type="button" id="cancel-featured-video-btn" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90">Save Video</button>
                    </div>
                </form>

                <h3 class="text-2xl md:text-3xl font-bold text-center text-primary mt-16 mb-8">Photos</h3>
                <div id="gallery-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
                <div class="text-center mt-8 admin-controls-inline"><button id="add-photo-btn" class="px-6 py-2 bg-green-500 text-white font-bold rounded-full hover:bg-green-600 transition duration-300 shadow-md">Add Photo</button></div>
                <form id="add-photo-form" class="max-w-3xl mx-auto mt-8 p-6 bg-white rounded-lg shadow-inner border">
                    <h3 class="text-xl font-bold text-primary mb-4">Add New Photo</h3>
                    <div class="mb-4">
                        <label for="photo-url" class="block text-gray-700 font-bold mb-2 text-left">Photo URL</label>
                        <input type="url" id="photo-url" class="w-full p-2 border rounded" placeholder="Paste direct image link...">
                    </div>
                    <div class="mb-4">
                        <label for="photo-caption" class="block text-gray-700 font-bold mb-2 text-left">Caption (Alt Text)</label>
                        <input type="text" id="photo-caption" class="w-full p-2 border rounded" placeholder="e.g., Jam session by the river">
                    </div>
                    <div class="flex justify-end space-x-4">
                        <button type="button" id="cancel-photo-btn" class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600">Cancel</button>
                        <button type="submit" id="submit-photo-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90">Save Photo</button>
                    </div>
                </form>
            </div>
        </section>
        
        <section id="contact" class="py-16 md:py-20 lg:py-24 bg-white"><div class="container mx-auto px-4 sm:px-6 text-center"><h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-primary mb-4">Join Us!</h2><p class="text-lg text-gray-600 max-w-3xl mx-auto mb-8">Want to join our mailing list for updates or have a question? Get in touch! We'd love to hear from you.</p><a href="mailto:info@galwayjamcircle.ie" class="px-8 py-3 bg-primary text-white font-bold rounded-full hover:opacity-90 transition duration-300 transform hover:scale-105 shadow-md">Email Us</a></div></section>
    </main>
    
    <footer class="bg-primary text-white/80 py-8">
        <div class="container mx-auto px-6 text-center">
            <div class="flex justify-center items-start space-x-6 mb-4">
                <div class="text-center">
                    <a href="https://www.facebook.com/groups/116675615376726" target="_blank" class="text-white hover:text-accent transition duration-300">
                        <svg class="w-6 h-6 mx-auto mb-1" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33V21.878A10.001 10.001 0 0022 12z" clip-rule="evenodd" /></svg>
                        <span class="text-xs">Group</span>
                    </a>
                </div>
                <div class="text-center">
                    <a href="https://www.facebook.com/profile.php?id=61570031297498" target="_blank" class="text-white hover:text-accent transition duration-300">
                        <svg class="w-6 h-6 mx-auto mb-1" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33V21.878A10.001 10.001 0 0022 12z" clip-rule="evenodd" /></svg>
                        <span class="text-xs">Page</span>
                    </a>
                </div>
                <a href="https://www.instagram.com/galwayjamcircle42/?hl=en" target="_blank" class="text-white hover:text-accent transition duration-300 pt-1">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.024.048-1.378.06-3.808.06s-2.784-.012-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.048-1.024-.06-1.378-.06-3.808s.012-2.784.06-3.808c.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 016.345 2.525c.636-.247 1.363-.416 2.427-.465C9.792 2.013 10.146 2 12.315 2zm0 1.623c-2.403 0-2.748.01-3.728.058-1.006.047-1.634.21-2.203.434a3.272 3.272 0 00-1.15 1.15c-.224.57-.386 1.198-.434 2.203-.048.98-.058 1.325-.058 3.728s.01 2.748.058 3.728c.048 1.006.21 1.634.434 2.203a3.272 3.272 0 001.15 1.15c.57.224 1.198.386 2.203.434.98.048 1.325.058 3.728.058s2.748-.01 3.728-.058c1.006-.047 1.634-.21 2.203-.434a3.272 3.272 0 001.15-1.15c.224-.57.386-1.198.434-2.203.048-.98.058-1.325.058-3.728s-.01-2.748-.058-3.728c-.048-1.006-.21-1.634-.434-2.203a3.272 3.272 0 00-1.15-1.15c-.57-.224-1.198-.386-2.203-.434C15.063 3.633 14.718 3.623 12.315 3.623zM12 9.75a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5zm0 6a3.75 3.75 0 110-7.5 3.75 3.75 0 010 7.5zM16.965 6.57a1.125 1.125 0 100 2.25 1.125 1.125 0 000-2.25z" clip-rule="evenodd" /></svg>
                </a>
            </div>
            <p>&copy; 2025 Galway Jam Circle. v1.5. All Rights Reserved.</p>
            <p class="text-sm text-stone-400 mt-2">Bringing music to the people of Galway.</p>
            <div class="space-x-4">
                 <a href="feedback.html" class="text-sm text-stone-400 hover:text-white mt-4 inline-block">Website Feedback</a>
                 <a href="#" id="admin-mode-btn" class="text-sm text-stone-400 hover:text-white mt-4 inline-block">Admin</a>
            </div>
        </div>
    </footer>

    <div id="custom-modal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center"><div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4"><p id="modal-message" class="text-lg mb-4"></p><input type="password" id="modal-input" class="w-full p-2 border rounded mb-4 hidden" placeholder="Enter password..."><div id="modal-buttons" class="flex justify-end space-x-4"></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, setDoc, deleteDoc, writeBatch, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC4SnqaOMQWmEFulkN8zZALZsqJLK7hOh0",
            authDomain: "galway-jam-circle-live.firebaseapp.com",
            projectId: "galway-jam-circle-live",
            storageBucket: "galway-jam-circle-live.appspot.com",
            messagingSenderId: "140452021164",
            appId: "1:140452021164:web:69703d13213d4ce49a3009"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', async () => {
            const menuBtn = document.getElementById('menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const adminModeBtn = document.getElementById('admin-mode-btn');
            
            menuBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
            const mobileLinks = mobileMenu.getElementsByTagName('a');
            for (let link of mobileLinks) {
                link.addEventListener('click', () => {
                    if(link.id !== 'mobile-admin-btn') {
                        mobileMenu.classList.add('hidden')
                    }
                });
            }

            new Swiper('.festival-carousel', {
                loop: true,
                autoplay: { delay: 4000, disableOnInteraction: false },
                pagination: { el: '.swiper-pagination', clickable: true },
                slidesPerView: 2,
                spaceBetween: 20,
                breakpoints: { 640: { slidesPerView: 3, spaceBetween: 30 }, 1024: { slidesPerView: 5, spaceBetween: 50 } }
            });

            const ADMIN_PASSWORD = '4519';
            let initialJams = [], initialEvents = [], initialPhotos = [], initialVenues = [], initialCommunityItems = [];
            let jams = [], events = [], photos = [], communityItems = [];
            let communitySwiper = null;

            // Element declarations
            const coverPhotoElement = document.getElementById('cover-photo');
            const editCoverPhotoBtn = document.getElementById('edit-cover-photo-btn');
            const editCoverPhotoForm = document.getElementById('edit-cover-photo-form');
            const coverPhotoUrlInput = document.getElementById('cover-photo-url');
            const cancelCoverPhotoBtn = document.getElementById('cancel-cover-photo-btn');
            
            const jamList = document.getElementById('jam-list');
            const addJamBtn = document.getElementById('add-jam-btn');
            const addJamForm = document.getElementById('add-jam-form');
            const cancelBtn = document.getElementById('cancel-btn');
            const formTitle = document.getElementById('form-title');
            const editJamIdInput = document.getElementById('edit-jam-id');
            const jamDateInput = document.getElementById('jam-date');
            const jamDayInput = document.getElementById('jam-day');
            const jamVenueInput = document.getElementById('jam-venue');
            const jamMapLinkInput = document.getElementById('jam-map-link');
            const jamTimeInput = document.getElementById('jam-time');
            
            const eventList = document.getElementById('event-list');
            const addEventBtn = document.getElementById('add-event-btn');
            const addEventForm = document.getElementById('add-event-form');
            const cancelEventBtn = document.getElementById('cancel-event-btn');
            const eventFormTitle = document.getElementById('event-form-title');
            const editEventIdInput = document.getElementById('edit-event-id');
            const eventTitleInput = document.getElementById('event-title');
            const eventDatesInput = document.getElementById('event-dates');
            const eventTimeInput = document.getElementById('event-time');
            const eventDescriptionInput = document.getElementById('event-description');
            
            const galleryGrid = document.getElementById('gallery-grid');
            const addPhotoBtn = document.getElementById('add-photo-btn');
            const addPhotoForm = document.getElementById('add-photo-form');
            const cancelPhotoBtn = document.getElementById('cancel-photo-btn');
            const photoUrlInput = document.getElementById('photo-url');
            const photoCaptionInput = document.getElementById('photo-caption');

            const featuredVideoPlayer = document.getElementById('featured-video-player');
            const editFeaturedVideoBtn = document.getElementById('edit-featured-video-btn');
            const editFeaturedVideoForm = document.getElementById('edit-featured-video-form');
            const featuredVideoUrlInput = document.getElementById('featured-video-url');
            const cancelFeaturedVideoBtn = document.getElementById('cancel-featured-video-btn');

            const communitySwiperWrapper = document.getElementById('community-swiper-wrapper');
            const addCommunityItemBtn = document.getElementById('add-community-item-btn');
            const addCommunityForm = document.getElementById('add-community-form');
            const cancelCommunityBtn = document.getElementById('cancel-community-btn');
            const communityFormTitle = document.getElementById('community-form-title');
            const editCommunityIdInput = document.getElementById('edit-community-id');
            const communityImageUrlInput = document.getElementById('community-image-url');
            const communityItemTypeInput = document.getElementById('community-item-type');
            const communityDescriptionInput = document.getElementById('community-description');
            const communityHeadlineWrapper = document.getElementById('community-headline-wrapper');
            const communityHeadlineInput = document.getElementById('community-headline');
            const charityFieldsWrapper = document.getElementById('charity-fields-wrapper');
            const communityAmountInput = document.getElementById('community-amount');
            const communityCharityNameInput = document.getElementById('community-charity-name');

            const modal = document.getElementById('custom-modal');
            const modalMessage = document.getElementById('modal-message');
            const modalInput = document.getElementById('modal-input');
            const modalButtons = document.getElementById('modal-buttons');
            const testDateInput = document.getElementById('test-date-input');
            const testDateBtn = document.getElementById('test-date-btn');
            const resetDateBtn = document.getElementById('reset-date-btn');
            const manageVenuesBtn = document.getElementById('manage-venues-btn');
            const venueManagementSection = document.getElementById('venue-management-section');
            const addVenueForm = document.getElementById('add-venue-form');
            const newVenueNameInput = document.getElementById('new-venue-name');
            const newVenueMapLinkInput = document.getElementById('new-venue-map-link');
            const venueListAdmin = document.getElementById('venue-list-admin');

            const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

            flatpickr(jamDateInput, { dateFormat: "j M:", onChange: function(selectedDates) { if (selectedDates.length > 0) { jamDayInput.value = dayNames[selectedDates[0].getDay()]; } }, });
            flatpickr(jamTimeInput, { enableTime: true, noCalendar: true, dateFormat: "h:i K", defaultDate: "2:00 PM" });
            flatpickr(eventDatesInput, { 
                mode: "range", 
                dateFormat: "j M Y",
                onClose: function(selectedDates, dateStr, instance) {
                    if (selectedDates.length === 1) {
                        const date = selectedDates[0];
                        instance.input.value = `${dayNames[date.getDay()]}, ${date.getDate()} ${date.toLocaleString('default', { month: 'short' })} ${date.getFullYear()}`;
                    } else if (selectedDates.length === 2) {
                        const start = selectedDates[0];
                        const end = selectedDates[1];
                        const format = (date) => `${dayNames[date.getDay()]}, ${date.getDate()} ${date.toLocaleString('default', { month: 'short' })}`;
                        instance.input.value = `${format(start)} - ${format(end)} ${end.getFullYear()}`;
                    }
                }
            });
            flatpickr(testDateInput, { dateFormat: "Y-m-d" });

            function parseJamDate(dateStr) { const year = 2025; const dateWithYear = dateStr.replace(':', '').trim() + ` ${year}`; return new Date(dateWithYear); }
            function formatJamDate(dateObj) { return `${dateObj.getDate()} ${dateObj.toLocaleString('default', { month: 'short' })}:`; }
            
            function formatTime(timeStr) {
                if (!timeStr || !timeStr.includes(':')) return timeStr; 
                if (timeStr.toLowerCase().includes('am') || timeStr.toLowerCase().includes('pm')) return timeStr; 
                
                const [hours, minutes] = timeStr.split(':');
                const h = parseInt(hours, 10);
                const suffix = h >= 12 ? 'PM' : 'AM';
                const formattedHours = ((h + 11) % 12 + 1);
                return `${formattedHours}:${minutes} ${suffix}`;
            }

            function manageJamSchedule(testDate = null) {
                const today = testDate || new Date();
                today.setHours(0, 0, 0, 0);
                let confirmedJams = JSON.parse(JSON.stringify(initialJams));
                let upcomingConfirmed = confirmedJams.filter(jam => { const jamDate = parseJamDate(jam.date); return jamDate && jamDate >= today; });
                let displayJams = [...upcomingConfirmed];
                let lastDate;
                if (displayJams.length > 0) { lastDate = displayJams.map(jam => parseJamDate(jam.date)).reduce((max, d) => d > max ? d : max); } 
                else { lastDate = new Date(today); lastDate.setDate(today.getDate() + (6 - today.getDay() + 7) % 7); lastDate.setDate(lastDate.getDate() - 7); }
                while (displayJams.length < 5) {
                    lastDate.setDate(lastDate.getDate() + 7);
                    const newId = String(Date.now() + displayJams.length);
                    displayJams.push({ id: newId, day: "Saturday", date: formatJamDate(new Date(lastDate)), venue: 'To be decided...', cancelled: false, isProposal: true, time: "2:00 PM" });
                }
                jams = displayJams;
            }

            function showModal(message, type = 'alert', onConfirm = () => {}, onCancel = () => {}) {
                modalMessage.textContent = message;
                modalButtons.innerHTML = '';
                modalInput.classList.add('hidden');
                if (type === 'alert') { const okButton = document.createElement('button'); okButton.textContent = 'OK'; okButton.className = 'px-4 py-2 bg-accent text-primary font-bold rounded-md'; okButton.onclick = () => { modal.classList.add('hidden'); modal.classList.remove('flex'); onConfirm(); }; modalButtons.appendChild(okButton); } 
                else if (type === 'confirm') { const confirmButton = document.createElement('button'); confirmButton.textContent = 'Confirm'; confirmButton.className = 'px-4 py-2 bg-red-500 text-white rounded-md'; confirmButton.onclick = () => { modal.classList.add('hidden'); modal.classList.remove('flex'); onConfirm(); }; const cancelButton = document.createElement('button'); cancelButton.textContent = 'Cancel'; cancelButton.className = 'px-4 py-2 bg-stone-600 text-white rounded-md'; cancelButton.onclick = () => { modal.classList.add('hidden'); modal.classList.remove('flex'); onCancel(); }; modalButtons.appendChild(cancelButton); modalButtons.appendChild(confirmButton); } 
                else if (type === 'prompt') { modalInput.classList.remove('hidden'); modalInput.value = ''; modalInput.type = 'password'; const submitButton = document.createElement('button'); submitButton.textContent = 'Submit'; submitButton.className = 'px-4 py-2 bg-accent text-primary font-bold rounded-md'; submitButton.onclick = () => { modal.classList.add('hidden'); modal.classList.remove('flex'); onConfirm(modalInput.value); }; const cancelButton = document.createElement('button'); cancelButton.textContent = 'Cancel'; cancelButton.className = 'px-4 py-2 bg-stone-600 text-white rounded-md'; cancelButton.onclick = () => { modal.classList.add('hidden'); modal.classList.remove('flex');}; modalButtons.appendChild(cancelButton); modalButtons.appendChild(submitButton); }
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                if(type === 'prompt') modalInput.focus();
            }

            function renderJams() {
                jamList.innerHTML = '';
                if (jams.length === 0) { jamList.innerHTML = `<li class="text-center text-gray-500">No upcoming jams scheduled.</li>`; }
                jams.sort((a, b) => parseJamDate(a.date) - parseJamDate(b.date)).forEach(jam => {
                    const li = document.createElement('li');
                    const isSaturday = jam.day.toLowerCase() === 'saturday';
                    li.className = 'p-4 rounded-lg shadow-sm border-l-4 flex flex-col sm:flex-row justify-between items-start sm:items-center bg-white border-gray-200';
                    li.classList.toggle('jam-special-day', !isSaturday);
                    if (jam.cancelled) { li.classList.add('jam-cancelled'); } 
                    let adminButtons = `<button data-id="${jam.id}" class="edit-btn text-blue-500 hover:text-blue-700">Edit</button>`;
                    if (!jam.isProposal) {
                        if (isSaturday) { adminButtons += jam.cancelled ? `<button data-id="${jam.id}" class="reinstate-btn text-green-600 hover:text-green-800 ml-2">Reinstate</button>` : `<button data-id="${jam.id}" class="cancel-btn text-yellow-600 hover:text-yellow-800 ml-2">Cancel Jam</button>`; } 
                        else { adminButtons += `<button data-id="${jam.id}" class="delete-btn text-red-500 hover:text-red-700 ml-2">Delete</button>`; }
                    }
                    let mapLink = jam.mapLink ? `<a href="${jam.mapLink}" onclick="window.open(this.href, '_blank'); return false;" class="text-blue-500 hover:underline ml-2">(Map)</a>` : '';
                    li.innerHTML = `<div class="flex-grow jam-info"><div class="flex flex-col sm:flex-row sm:items-center"><span class="font-bold text-lg ${isSaturday ? 'text-gray-500' : 'text-yellow-600'}">${jam.day}</span><span class="text-lg font-bold text-primary sm:ml-4">${jam.date}</span><span class="text-lg font-bold text-gray-600 sm:ml-2">${formatTime(jam.time || '2:00 PM')}</span></div><span class="text-gray-700 text-lg">${jam.venue} ${mapLink}</span>${jam.cancelled ? '<span class="font-bold text-red-600 mt-1 sm:ml-4">(CANCELLED)</span>' : ''}</div><div class="admin-controls-inline space-x-2 mt-2 sm:mt-0">${adminButtons}</div>`;
                    jamList.appendChild(li);
                });
            }

            function renderEvents() {
                eventList.innerHTML = '';
                events = [...initialEvents];
                if (events.length === 0) { eventList.innerHTML = `<p class="text-center text-gray-500">No special events scheduled at this time.</p>`; }
                events.forEach(event => {
                    const div = document.createElement('div');
                    div.className = 'bg-white p-6 rounded-lg shadow-md relative border border-gray-200';
                    const timeHTML = event.time ? `<span class="text-gray-600 font-semibold">${event.time}</span>` : '';
                    div.innerHTML = `<div class="admin-controls-inline absolute top-2 right-2 space-x-2"><button data-id="${event.id}" class="edit-event-btn text-blue-500 hover:text-blue-700">Edit</button><button data-id="${event.id}" class="delete-event-btn text-red-500 hover:text-red-700">Delete</button></div><h3 class="text-2xl font-bold text-primary">${event.title}</h3><div class="flex items-center space-x-4 mt-1"><p class="text-lg font-semibold text-gray-700">${event.dates}</p>${timeHTML}</div><p class="mt-4 text-gray-600">${event.description}</p>`;
                    eventList.appendChild(div);
                });
            }

            function renderGallery() {
                galleryGrid.innerHTML = '';
                photos = [...initialPhotos];
                if (photos.length === 0) { galleryGrid.innerHTML = `<p class="text-center text-gray-500 col-span-full">The photo gallery is empty. Add some photos!</p>`; }
                photos.forEach(photo => {
                    const div = document.createElement('div');
                    div.className = 'gallery-item overflow-hidden rounded-lg shadow-lg';
                    div.innerHTML = `<img src="${photo.url}" alt="${photo.caption}" class="w-full h-full object-cover transform hover:scale-110 transition duration-500"><button data-id="${photo.id}" class="delete-photo-btn admin-controls-inline bg-red-500 text-white rounded-full p-1 hover:bg-red-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></button>`;
                    galleryGrid.appendChild(div);
                });
            }

            function renderCommunitySlider() {
                communityItems = [...initialCommunityItems];
                communitySwiperWrapper.innerHTML = '';
                if (communityItems.length === 0) {
                    communitySwiperWrapper.innerHTML = `<div class="swiper-slide flex items-center justify-center bg-gray-100 text-gray-500 p-4 rounded-lg">No community events to show.</div>`;
                } else {
                    communityItems.forEach(item => {
                        const slide = document.createElement('div');
                        slide.className = 'swiper-slide';

                        let headlineHTML = '';
                        if (item.type === 'charity' && item.amountRaised && item.charityName) {
                            headlineHTML = `<h3 class="font-bold text-primary text-xl mb-2">Amount Raised: ${item.amountRaised} for ${item.charityName}</h3>`;
                        } else if (item.type === 'community' && item.headline) {
                             headlineHTML = `<h3 class="font-bold text-primary text-xl mb-2">${item.headline}</h3>`;
                        }

                        slide.innerHTML = `
                            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                                <div class="relative community-image-container">
                                    <img src="${item.imageUrl}" alt="${item.description.substring(0, 50)}">
                                    <div class="slide-admin-controls admin-controls-inline space-x-2">
                                        <button data-id="${item.id}" class="edit-community-btn bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 shadow-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg></button>
                                        <button data-id="${item.id}" class="delete-community-btn bg-red-500 text-white p-2 rounded-full hover:bg-red-600 shadow-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg></button>
                                    </div>
                                </div>
                                <div class="p-6">
                                    ${headlineHTML}
                                    <p class="text-gray-600">${item.description}</p>
                                </div>
                            </div>
                        `;
                        communitySwiperWrapper.appendChild(slide);
                    });
                }

                if (communitySwiper) { communitySwiper.destroy(true, true); }
                communitySwiper = new Swiper('.community-swiper', {
                    effect: 'fade',
                    fadeEffect: { crossFade: true },
                    loop: communityItems.length > 1,
                    autoplay: { delay: 6000, disableOnInteraction: false },
                    pagination: { el: '.swiper-pagination', clickable: true },
                    navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
                });
            }

            function showJamForm(mode = 'add', jam = null) {
                addJamForm.style.display = 'block';
                jamVenueInput.innerHTML = '';
                initialVenues.forEach(venue => { const option = document.createElement('option'); option.value = venue.name; option.textContent = venue.name; jamVenueInput.appendChild(option); });
                if (mode === 'edit') { formTitle.textContent = 'Edit Jam'; editJamIdInput.value = jam.id; jamDatepicker.setDate(parseJamDate(jam.date)); jamDayInput.value = jam.day; jamVenueInput.value = jam.venue; jamMapLinkInput.value = jam.mapLink || ''; flatpickr(jamTimeInput, { enableTime: true, noCalendar: true, dateFormat: "h:i K", defaultDate: jam.time || "2:00 PM" }); } 
                else { formTitle.textContent = 'Add a New Jam'; editJamIdInput.value = ''; const lastJamDate = jams.length > 0 ? parseJamDate(jams[jams.length - 1].date) : new Date(); lastJamDate.setDate(lastJamDate.getDate() + 7); jamDatepicker.setDate(lastJamDate); jamDayInput.value = dayNames[lastJamDate.getDay()]; jamVenueInput.value = ''; jamMapLinkInput.value = ''; flatpickr(jamTimeInput, { enableTime: true, noCalendar: true, dateFormat: "h:i K", defaultDate: "2:00 PM" }); }
                jamVenueInput.focus();
            }
            function hideJamForm() { addJamForm.style.display = 'none'; }
            function showEventForm(mode = 'add', event = null) {
                addEventForm.style.display = 'block';
                if (mode === 'edit') { 
                    eventFormTitle.textContent = 'Edit Event'; 
                    editEventIdInput.value = event.id; 
                    eventTitleInput.value = event.title; 
                    eventDatesInput.value = event.dates; 
                    eventTimeInput.value = event.time || '';
                    eventDescriptionInput.value = event.description; 
                } else { 
                    eventFormTitle.textContent = 'Add a New Event'; 
                    editEventIdInput.value = ''; 
                    eventTitleInput.value = ''; 
                    eventDatesInput.value = ''; 
                    eventTimeInput.value = '';
                    eventDescriptionInput.value = ''; 
                }
                eventTitleInput.focus();
            }
            function hideEventForm() { addEventForm.style.display = 'none'; }
            function showPhotoForm() { addPhotoForm.style.display = 'block'; }
            function hidePhotoForm() { addPhotoForm.style.display = 'none'; }
            
            function showCommunityForm(mode = 'add', item = null) {
                addCommunityForm.style.display = 'block';
                if (mode === 'edit') {
                    communityFormTitle.textContent = 'Edit Community/Charity Item';
                    editCommunityIdInput.value = item.id;
                    communityImageUrlInput.value = item.imageUrl;
                    communityItemTypeInput.value = item.type;
                    communityDescriptionInput.value = item.description;
                    communityHeadlineInput.value = item.headline || '';
                    communityAmountInput.value = item.amountRaised || '';
                    communityCharityNameInput.value = item.charityName || '';
                } else {
                    communityFormTitle.textContent = 'Add New Community/Charity Item';
                    editCommunityIdInput.value = '';
                    addCommunityForm.reset();
                }
                communityItemTypeInput.dispatchEvent(new Event('change'));
                communityImageUrlInput.focus();
            }
            function hideCommunityForm() { addCommunityForm.style.display = 'none'; }

            function toggleAdminMode(enable) {
                 if(enable) { document.body.classList.add('admin-mode'); adminModeBtn.textContent = 'Exit Admin'; document.getElementById('jams').scrollIntoView({ behavior: 'smooth' }); } 
                 else { document.body.classList.remove('admin-mode'); adminModeBtn.textContent = 'Admin'; hideJamForm(); hideEventForm(); hidePhotoForm(); hideCommunityForm(); venueManagementSection.style.display = 'none'; }
                 renderJams();
                 renderEvents();
                 renderGallery();
                 renderCommunitySlider();
            }

            function handleAdminClick(e) {
                e.preventDefault();
                const isAdmin = document.body.classList.contains('admin-mode');
                if (isAdmin) { toggleAdminMode(false); } 
                else { showModal('Enter admin password:', 'prompt', (password) => { if (password === ADMIN_PASSWORD) { toggleAdminMode(true); } else { showModal('Incorrect password.', 'alert'); } }); }
            }
            adminModeBtn.addEventListener('click', handleAdminClick);
            document.body.addEventListener('click', (e) => { if (e.target.classList.contains('exit-admin-btn')) { toggleAdminMode(false); } });

            // Jam Logic
            addJamBtn.addEventListener('click', () => showJamForm('add'));
            cancelBtn.addEventListener('click', hideJamForm);
            async function saveJam(jamData) { await setDoc(doc(db, "jams", String(jamData.id)), jamData); await loadData(); }
            addJamForm.addEventListener('submit', async (e) => { e.preventDefault(); const date = jamDateInput.value.trim(); const day = jamDayInput.value.trim(); const venue = jamVenueInput.value.trim(); let id = editJamIdInput.value; const mapLink = jamMapLinkInput.value.trim(); const time = jamTimeInput.value.trim(); if (!date || !venue || !day) { showModal('Please fill in all jam fields.', 'alert'); return; } const jamDate = date.endsWith(':') ? date : date + ':'; if (!id || jams.find(j => j.id === id)?.isProposal) { id = String(Date.now()); } await saveJam({ id, date: jamDate, day, venue, cancelled: false, mapLink, time }); hideJamForm(); });
            jamVenueInput.addEventListener('change', () => { const selectedVenue = initialVenues.find(v => v.name === jamVenueInput.value); if (selectedVenue) { jamMapLinkInput.value = selectedVenue.mapLink; } });
            jamList.addEventListener('click', async (e) => { const target = e.target; const jamId = target.dataset.id; if (!jamId) return; const jamInDisplay = jams.find(j => j.id === jamId); if (target.classList.contains('edit-btn')) { if (jamInDisplay) showJamForm('edit', jamInDisplay); } else if (target.classList.contains('delete-btn')) { showModal('Are you sure you want to delete this special jam?', 'confirm', async () => { await deleteDoc(doc(db, "jams", jamId)); await loadData(); }); } else if (target.classList.contains('cancel-btn')) { showModal('Are you sure you want to cancel this jam?', 'confirm', async () => { if (jamInDisplay) { jamInDisplay.cancelled = true; await saveJam(jamInDisplay); } }); } else if (target.classList.contains('reinstate-btn')) { if (jamInDisplay) { jamInDisplay.cancelled = false; await saveJam(jamInDisplay); } } });

            // Event Logic
            addEventBtn.addEventListener('click', () => showEventForm('add'));
            cancelEventBtn.addEventListener('click', hideEventForm);
            async function saveEvent(eventData) { await setDoc(doc(db, "events", String(eventData.id)), eventData); await loadData(); }
            addEventForm.addEventListener('submit', async (e) => { e.preventDefault(); const title = eventTitleInput.value.trim(); const dates = eventDatesInput.value.trim(); const description = eventDescriptionInput.value.trim(); let id = editEventIdInput.value; const time = eventTimeInput.value.trim(); if (!title || !dates || !description) { showModal('Please fill in all event fields.', 'alert'); return; } if (!id) { id = String(Date.now()); } await saveEvent({ id, title, dates, description, time }); hideEventForm(); });
            eventList.addEventListener('click', async (e) => { const target = e.target; const eventId = target.dataset.id; if (!eventId) return; if (target.classList.contains('edit-event-btn')) { const eventToEdit = initialEvents.find(ev => ev.id == eventId); if (eventToEdit) showEventForm('edit', eventToEdit); } else if (target.classList.contains('delete-event-btn')) { showModal('Are you sure you want to delete this event?', 'confirm', async () => { await deleteDoc(doc(db, "events", eventId)); await loadData(); }); } });
            
            // Config Logic (Cover Photo & Video)
            editCoverPhotoBtn.addEventListener('click', () => { editCoverPhotoForm.style.display = 'block'; });
            cancelCoverPhotoBtn.addEventListener('click', () => { editCoverPhotoForm.style.display = 'none'; });
            editCoverPhotoForm.addEventListener('submit', async (e) => { e.preventDefault(); const newUrl = coverPhotoUrlInput.value.trim(); if (!newUrl) { showModal('Please enter a URL.', 'alert'); return; } await setDoc(doc(db, "site_config", "main"), { coverPhotoUrl: newUrl }, { merge: true }); await loadData(); editCoverPhotoForm.style.display = 'none'; });
            editFeaturedVideoBtn.addEventListener('click', () => { editFeaturedVideoForm.style.display = 'block'; });
            cancelFeaturedVideoBtn.addEventListener('click', () => { editFeaturedVideoForm.style.display = 'none'; });
            editFeaturedVideoForm.addEventListener('submit', async (e) => { e.preventDefault(); const newUrl = featuredVideoUrlInput.value.trim(); if (!newUrl) { showModal('Please enter a YouTube URL.', 'alert'); return; } await setDoc(doc(db, "site_config", "main"), { featuredVideoUrl: newUrl }, { merge: true }); await loadData(); editFeaturedVideoForm.style.display = 'none'; });

            // Gallery Logic
            addPhotoBtn.addEventListener('click', () => showPhotoForm());
            cancelPhotoBtn.addEventListener('click', hidePhotoForm);
            addPhotoForm.addEventListener('submit', async (e) => { e.preventDefault(); const url = photoUrlInput.value.trim(); const caption = photoCaptionInput.value.trim(); const id = String(Date.now()); if (!url || !caption) { showModal('Please provide both a URL and a caption.', 'alert'); return; } await setDoc(doc(db, "photos", id), { id, type: 'image', url, caption }); await loadData(); hidePhotoForm(); });
            galleryGrid.addEventListener('click', async (e) => { const deleteBtn = e.target.closest('.delete-photo-btn'); if (!deleteBtn) return; const photoId = deleteBtn.dataset.id; showModal('Are you sure you want to delete this media?', 'confirm', async () => { await deleteDoc(doc(db, "photos", photoId)); await loadData(); }); });

            // Community Section Logic
            addCommunityItemBtn.addEventListener('click', () => showCommunityForm('add'));
            cancelCommunityBtn.addEventListener('click', hideCommunityForm);
            communityItemTypeInput.addEventListener('change', (e) => {
                const isCharity = e.target.value === 'charity';
                charityFieldsWrapper.classList.toggle('hidden', !isCharity);
                communityHeadlineWrapper.classList.toggle('hidden', isCharity);
            });
            
            async function saveCommunityItem(itemData) { await setDoc(doc(db, "community", String(itemData.id)), itemData); await loadData(); }
            addCommunityForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                let id = editCommunityIdInput.value;
                const imageUrl = communityImageUrlInput.value.trim();
                const description = communityDescriptionInput.value.trim();
                const type = communityItemTypeInput.value;
                
                if (!imageUrl || !description) { showModal('Please provide an Image URL and a Description.', 'alert'); return; }
                if (!id) { id = String(Date.now()); }

                const itemData = { id, imageUrl, description, type };

                if (type === 'charity') {
                    itemData.amountRaised = communityAmountInput.value.trim();
                    itemData.charityName = communityCharityNameInput.value.trim();
                    if (!itemData.amountRaised || !itemData.charityName) {
                        showModal('For charity events, please provide both the amount and the charity name.', 'alert');
                        return;
                    }
                } else {
                    itemData.headline = communityHeadlineInput.value.trim();
                    if (!itemData.headline) {
                        showModal('For community events, please provide a headline.', 'alert');
                        return;
                    }
                }
                
                await saveCommunityItem(itemData);
                hideCommunityForm();
            });
            communitySwiperWrapper.addEventListener('click', async (e) => {
                const editBtn = e.target.closest('.edit-community-btn');
                const deleteBtn = e.target.closest('.delete-community-btn');
                if (!editBtn && !deleteBtn) return;
                const itemId = (editBtn || deleteBtn).dataset.id;
                const itemToActOn = initialCommunityItems.find(item => item.id === itemId);
                if (!itemToActOn) return;
                if (editBtn) { showCommunityForm('edit', itemToActOn); } 
                else if (deleteBtn) { showModal('Are you sure you want to delete this item?', 'confirm', async () => { await deleteDoc(doc(db, "community", itemId)); await loadData(); }); }
            });

            // Date Testing & Venue Management
            testDateBtn.addEventListener('click', () => { const testDateStr = testDateInput.value; if (testDateStr) { const testDate = new Date(testDateStr); if (!isNaN(testDate.getTime())) { manageJamSchedule(testDate); renderJams(); } else { showModal('Invalid date format.', 'alert'); } } });
            resetDateBtn.addEventListener('click', () => { manageJamSchedule(); renderJams(); testDateInput.value = ''; });
            manageVenuesBtn.addEventListener('click', () => { venueManagementSection.style.display = venueManagementSection.style.display === 'none' ? 'block' : 'none'; });

            async function loadData() {
                try {
                    console.log("Loading data from Firestore...");
                    const [jamSnapshot, eventSnapshot, photoSnapshot, venueSnapshot, communitySnapshot, configDoc] = await Promise.all([
                        getDocs(collection(db, "jams")),
                        getDocs(collection(db, "events")),
                        getDocs(collection(db, "photos")),
                        getDocs(collection(db, "venues")),
                        getDocs(collection(db, "community")),
                        getDoc(doc(db, "site_config", "main"))
                    ]);

                    initialJams = jamSnapshot.docs.map(doc => doc.data());
                    initialEvents = eventSnapshot.docs.map(doc => doc.data());
                    initialPhotos = photoSnapshot.docs.map(doc => doc.data());
                    initialVenues = venueSnapshot.docs.map(doc => doc.data());
                    initialCommunityItems = communitySnapshot.docs.map(doc => doc.data());
                    
                    if (configDoc.exists()) {
                        const configData = configDoc.data();
                        if (configData.coverPhotoUrl) { coverPhotoElement.src = configData.coverPhotoUrl; }
                        if (configData.featuredVideoUrl) { const videoId = configData.featuredVideoUrl.split('v=')[1]?.split('&')[0] || configData.featuredVideoUrl.split('/').pop(); featuredVideoPlayer.src = `https://www.youtube.com/embed/${videoId}`; } 
                        else { featuredVideoPlayer.src = `https://www.youtube.com/embed/SeFUhhhVZ9k`; }
                    } else {
                        await setDoc(doc(db, "site_config", "main"), { coverPhotoUrl: "...", featuredVideoUrl: "..." });
                        await loadData(); return;
                    }

                    let needsSeeding = false;
                    const batch = writeBatch(db);
                    if (initialJams.length === 0) { needsSeeding = true; /* ... seed jams ... */ }
                    if (initialEvents.length === 0) { 
                        needsSeeding = true;
                        const seedEvents = [
                            { id: "101", title: "Cleggan Fringe Festival", dates: "Friday, 12 Sept - Sunday, 14 Sept 2025", description: "The annual Cleggan Fringe Festival is a highlight of the year! Featuring a host of traditional and folk musicians in the pubs and venues around Cleggan. Keep an eye out for GJC members playing sessions!", time: ""},
                            { id: "102", title: "Culture Night with the Galway Jam Circle", dates: "Friday, 19 Sept 2025", time: "5:45 PM - 7:45 PM", description: "Join us for a special evening of music to celebrate Culture Night! We'll be hosting an open and inclusive jam session at the Mechanics' Institute, with smaller groups also playing outside on the street. All are welcome to play, sing along, or just enjoy the atmosphere as we share our love of music with the city."}
                        ];
                        seedEvents.forEach(event => batch.set(doc(db, "events", event.id), event));
                     }
                    if (initialPhotos.length === 0) { needsSeeding = true; /* ... seed photos ... */ }
                    if (initialVenues.length === 0) { needsSeeding = true; /* ... seed venues ... */ }
                    if (initialCommunityItems.length === 0) {
                        needsSeeding = true;
                        const seedCommunity = [
                            { id: "c1", type: "charity", imageUrl: "https://www.advertiser.ie/images/2018/12/154215.jpg", description: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation.", amountRaised: "€1,234", charityName: "A Local Charity" },
                            { id: "c2", type: "community", imageUrl: "https://i.ytimg.com/vi/WDDg-vo9i5U/maxresdefault.jpg", description: "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia.", headline: "Music at the Community Fair" }
                        ];
                        seedCommunity.forEach(item => batch.set(doc(db, "community", item.id), item));
                    }

                    if (needsSeeding) {
                        showModal("Database empty or incomplete. Seeding with initial data. Please refresh if you don't see it.", "alert");
                        await batch.commit();
                        await loadData(); return;
                    }

                    manageJamSchedule();
                    renderJams();
                    renderEvents();
                    renderGallery();
                    renderCommunitySlider();
                } catch (error) {
                    console.error("Error loading data: ", error);
                    if (error.message.includes("Missing or insufficient permissions")) { showModal("Could not connect to the database. Ensure Firestore security rules are set to test mode.", "alert"); } 
                    else if (firebaseConfig.apiKey.includes("AIzaSyC4SnqaOMQWmEFulkN8zZALZsqJLK7hOh0")) { showModal("Firebase is not configured. Please paste your firebaseConfig object into the HTML file.", "alert"); } 
                    else { showModal("Could not load data from the database.", "alert"); }
                }
            }

            await loadData();
        });
    </script>

</body>
</html>
