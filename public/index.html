<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Galway Jam Circle - Official Website</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/swiper/swiper-bundle.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        --primary-color: #371087; /* Correct Purple */
        --accent-color: #f3ead3; /* Warm Cream */
        --background-color: #ffffff;
        --text-dark: #1f2937;
        --text-light: #ffffff;
      }
      body {
        font-family: "Inter", sans-serif;
        background-color: var(--background-color);
        color: var(--text-dark);
      }
      .bg-primary {
        background-color: var(--primary-color);
      }
      .text-primary {
        color: var(--primary-color);
      }
      .bg-accent {
        background-color: var(--accent-color);
      }
      .text-accent {
        color: var(--accent-color);
      }
      .border-primary {
        border-color: var(--primary-color);
      }
      .admin-controls,
      .admin-controls-inline {
        display: none;
      }
      body.admin-mode .admin-controls {
        display: block;
      }
      body.admin-mode .admin-controls-inline {
        display: inline-flex;
      }
      #add-jam-form,
      #add-event-form,
      #add-photo-form,
      #edit-cover-photo-form,
      #edit-featured-video-form,
      #venue-management-section,
      #add-community-form {
        display: none;
      }
      .jam-cancelled {
        background-color: #fee2e2 !important;
      }
      .jam-cancelled .jam-info {
        text-decoration: line-through;
      }
      .jam-special {
        border-left-color: #a78bfa !important; /* A subtle violet for special days */
        border-left-width: 4px;
      }
      .gallery-item {
        position: relative;
      }
      .gallery-item .delete-photo-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
      }
      details > summary {
        cursor: pointer;
      }
      /* Festival Carousel Styles */
      .festival-carousel {
        padding-top: 1rem;
        padding-bottom: 3rem; /* Space for pagination */
      }
      .festival-carousel .swiper-slide {
        height: 120px; /* Consistent height for logos */
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .festival-carousel .swiper-slide img {
        max-height: 90px;
        width: auto;
        object-fit: contain;
        opacity: 0.9;
        transition: all 0.3s ease;
      }
      .festival-carousel .swiper-slide:hover img {
        opacity: 1;
        transform: scale(1.05);
      }
      .swiper-pagination-bullet-active {
        background-color: var(--primary-color) !important;
      }
      /* Community Slideshow Styles */
      .community-swiper {
        width: 100%;
      }
      .community-swiper .swiper-slide {
        position: relative;
      }
      .community-swiper .slide-admin-controls {
        position: absolute;
        top: 1rem;
        right: 1rem;
        z-index: 10;
      }
      .community-swiper .swiper-button-next,
      .community-swiper .swiper-button-prev {
        color: var(--accent-color);
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 50%;
        width: 44px;
        height: 44px;
        --swiper-navigation-size: 22px;
      }
      .community-swiper .swiper-button-next:hover,
      .community-swiper .swiper-button-prev:hover {
        background-color: rgba(0, 0, 0, 0.5);
      }
      .community-swiper .swiper-pagination {
        position: static;
        margin-top: 1rem;
      }
      /* Responsive Image container style */
      .community-image-container {
        width: 100%;
        height: 20rem; /* 320px for mobile */
        background-color: #f0f0f0; /* light gray */
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      .community-image-container img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Default to cover for mobile */
      }
      @media (min-width: 768px) {
        /* md breakpoint */
        .community-image-container {
          height: 24rem; /* 384px for desktop */
        }
        .community-image-container img {
          object-fit: contain; /* Switch to contain for desktop */
        }
      }
    </style>
  </head>
  <body class="text-gray-800">
    <header class="bg-primary shadow-lg sticky top-0 z-50">
      <nav
        class="container mx-auto px-4 sm:px-6 py-3 flex justify-between items-center"
      >
        <div class="flex items-center space-x-2 sm:space-x-4">
          <div class="w-12 h-12 sm:w-14 sm:h-14">
            <img
              src="images/logo.jpg"
              alt="Galway Jam Circle Logo"
              class="rounded-full"
            />
          </div>
          <div class="text-white text-lg sm:text-2xl font-bold tracking-tight">
            Galway Jam Circle
          </div>
        </div>
        <div class="hidden md:flex items-center space-x-2">
          <a
            href="#home"
            class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300"
            >Home</a
          >
          <a
            href="#jams"
            class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300"
            >Regular Jams</a
          >
          <a
            href="#format"
            class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300"
            >Our Format</a
          >
          <a
            href="#special-events"
            class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300"
            >Festivals & Events</a
          >
          <a
            href="#community"
            class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300"
            >Community</a
          >
          <a
            href="#gallery"
            class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300"
            >Gallery</a
          >
          <a
            href="https://drive.google.com/file/d/1V3X3K5hwUHxZtn3o29Wd6ZZ4twz4x0j_/view?usp=sharing"
            target="_blank"
            class="text-primary bg-accent px-4 py-3 rounded-md hover:bg-opacity-80 transition duration-300 font-bold"
            >Songbook</a
          >
          <a
            href="#contact"
            class="text-white px-4 py-2 rounded-md hover:bg-white/10 transition duration-300"
            >Contact</a
          >
        </div>
        <div class="md:hidden">
          <button id="menu-btn" class="text-white focus:outline-none">
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7"
              ></path>
            </svg>
          </button>
        </div>
      </nav>
      <div id="mobile-menu" class="md:hidden hidden bg-primary/95">
        <a
          href="#home"
          class="block text-white text-center py-3 hover:bg-white/10"
          >Home</a
        >
        <a
          href="#jams"
          class="block text-white text-center py-3 hover:bg-white/10"
          >Regular Jams</a
        >
        <a
          href="#format"
          class="block text-white text-center py-3 hover:bg-white/10"
          >Our Format</a
        >
        <a
          href="#special-events"
          class="block text-white text-center py-3 hover:bg-white/10"
          >Festivals & Events</a
        >
        <a
          href="#community"
          class="block text-white text-center py-3 hover:bg-white/10"
          >Community</a
        >
        <a
          href="#gallery"
          class="block text-white text-center py-3 hover:bg-white/10"
          >Gallery</a
        >
        <a
          href="https://drive.google.com/file/d/1V3X3K5hwUHxZtn3o29Wd6ZZ4twz4x0j_/view?usp=sharing"
          target="_blank"
          class="block text-primary text-center font-bold py-3 bg-accent hover:bg-opacity-80"
          >Songbook</a
        >
        <a
          href="#contact"
          class="block text-white text-center py-3 hover:bg-white/10"
          >Contact</a
        >
      </div>
    </header>

    <main>
      <section id="home" class="relative text-white text-center">
        <img
          id="cover-photo"
          src="https://scontent-dub4-1.xx.fbcdn.net/v/t39.30808-6/340126198_1202888093755813_6375467148998027340_n.jpg?_nc_cat=105&ccb=1-7&_nc_sid=2285d6&_nc_ohc=wA-6pUbx_XYQ7kNvwHkWjV3&_nc_oc=Adnd0Bbs-9bBGiNkVlqTm636JeXERyh16eo2fUrKp5p7sPkeFMlKHcYdyTj8qGDYzQk&_nc_zt=23&_nc_ht=scontent-dub4-1.xx&_nc_gid=Pse2aOVgLI3EOs4_MVhu_Q&oh=00_AfWMKMB5g8K5fFbQO5RjBf8Wp9epHYVIZ5FuDYFFu1qEsg&oe=689D27F9"
          alt="A group of people playing instruments like guitars and ukuleles by a river in Galway."
          class="w-full h-[70vh] object-cover"
        />
        <div
          class="absolute inset-0 bg-gradient-to-t from-black/75 to-transparent flex flex-col justify-end items-center p-6 sm:p-12"
        >
          <h1
            class="text-4xl sm:text-5xl md:text-6xl font-bold text-white drop-shadow-2xl"
          >
            Welcome to the Galway Jam Circle
          </h1>
          <p
            class="mt-4 text-lg sm:text-xl max-w-3xl text-white/90 drop-shadow-xl"
          >
            A friendly, informal music-making community for all skill levels.
            Let's Jam!
          </p>
          <div
            class="mt-8 flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4"
          >
            <a
              href="#jams"
              class="px-8 py-3 bg-accent text-primary font-bold rounded-full hover:bg-opacity-80 transition duration-300 transform hover:scale-105 shadow-lg"
              >See Regular Jams</a
            >
            <div class="flex items-start space-x-4">
              <div class="text-center">
                <a
                  href="https://www.facebook.com/groups/116675615376726"
                  target="_blank"
                  class="text-white hover:text-accent transition duration-300"
                >
                  <svg
                    class="w-8 h-8 mx-auto mb-1"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33V21.878A10.001 10.001 0 0022 12z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  <span class="text-xs font-semibold">Group</span>
                </a>
              </div>
              <div class="text-center">
                <a
                  href="https://www.facebook.com/profile.php?id=61570031297498"
                  target="_blank"
                  class="text-white hover:text-accent transition duration-300"
                >
                  <svg
                    class="w-8 h-8 mx-auto mb-1"
                    fill="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33V21.878A10.001 10.001 0 0022 12z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  <span class="text-xs font-semibold">Page</span>
                </a>
              </div>
              <a
                href="https://www.instagram.com/galwayjamcircle42/?hl=en"
                target="_blank"
                class="text-white hover:text-accent transition duration-300 pt-1"
              >
                <svg
                  class="w-8 h-8"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    fill-rule="evenodd"
                    d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.024.048-1.378.06-3.808.06s-2.784-.012-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.048-1.024-.06-1.378-.06-3.808s.012-2.784.06-3.808c.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 016.345 2.525c.636-.247 1.363-.416 2.427-.465C9.792 2.013 10.146 2 12.315 2zm0 1.623c-2.403 0-2.748.01-3.728.058-1.006.047-1.634.21-2.203.434a3.272 3.272 0 00-1.15 1.15c-.224.57-.386 1.198-.434 2.203-.048.98-.058 1.325-.058 3.728s.01 2.748.058 3.728c.048 1.006.21 1.634.434 2.203a3.272 3.272 0 001.15 1.15c.57.224 1.198.386 2.203.434.98.048 1.325.058 3.728.058s2.748-.01 3.728-.058c1.006-.047 1.634-.21 2.203-.434a3.272 3.272 0 001.15-1.15c.224-.57.386-1.198.434-2.203.048-.98.058-1.325.058-3.728s-.01-2.748-.058-3.728c-.048-1.006-.21-1.634-.434-2.203a3.272 3.272 0 00-1.15-1.15c-.57-.224-1.198-.386-2.203-.434C15.063 3.633 14.718 3.623 12.315 3.623zM12 9.75a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5zm0 6a3.75 3.75 0 110-7.5 3.75 3.75 0 010 7.5zM16.965 6.57a1.125 1.125 0 100 2.25 1.125 1.125 0 000-2.25z"
                    clip-rule="evenodd"
                  />
                </svg>
              </a>
            </div>
          </div>
        </div>
      </section>

      <div
        class="container mx-auto px-4 sm:px-6 text-center -mt-8 relative z-10"
      >
        <div class="admin-controls-inline items-center justify-center">
          <button
            id="edit-cover-photo-btn"
            class="px-4 py-2 bg-blue-500 text-white font-bold rounded-full hover:bg-blue-600 transition duration-300 shadow-md"
          >
            Change Cover Photo
          </button>
          <button
            class="exit-admin-btn px-4 py-2 bg-red-600 text-white font-bold rounded-full hover:bg-red-700 transition duration-300 shadow-md ml-4"
          >
            Exit Admin Mode
          </button>
        </div>
        <form
          id="edit-cover-photo-form"
          class="max-w-xl mx-auto mt-4 p-6 bg-white rounded-lg shadow-xl border border-gray-200"
        >
          <h3 class="text-xl font-bold text-primary mb-4">
            Change Cover Photo
          </h3>
          <div class="mb-4">
            <label
              for="cover-photo-url"
              class="block text-gray-700 font-bold mb-2 text-left"
              >New Photo URL</label
            >
            <input
              type="url"
              id="cover-photo-url"
              class="w-full p-2 border rounded"
              placeholder="Paste direct image link..."
            />
          </div>
          <div class="flex justify-end space-x-4">
            <button
              type="button"
              id="cancel-cover-photo-btn"
              class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90"
            >
              Save Photo
            </button>
          </div>
        </form>
      </div>

      <section id="jams" class="py-16 md:py-20 lg:py-24 bg-white">
        <div class="container mx-auto px-4 sm:px-6">
          <div class="text-center mb-12">
            <h2
              class="text-3xl md:text-4xl lg:text-5xl font-bold text-primary mb-4"
            >
              Regular Jams
            </h2>
            <p class="text-lg text-gray-600 max-w-3xl mx-auto">
              Our weekly jam schedule. Voluntary donations are welcome to help
              cover venue costs.
            </p>

            <div class="mt-8">
              <a
                href="#"
                onclick="return false;"
                class="px-8 py-3 bg-accent text-primary font-bold rounded-full transition duration-300 shadow-lg opacity-60 cursor-not-allowed"
              >
                Contribute €5 for the Jam
              </a>
              <p class="text-sm text-gray-500 mt-2 font-semibold">
                (Payment feature coming soon - for demonstration only)
              </p>
            </div>
          </div>
          <div class="max-w-4xl mx-auto">
            <ul id="jam-list" class="space-y-4"></ul>
            <div
              class="text-center mt-8 admin-controls-inline flex-wrap justify-center gap-4"
            >
              <button
                id="add-jam-btn"
                class="px-6 py-2 bg-green-500 text-white font-bold rounded-full hover:bg-green-600 transition duration-300 shadow-md"
              >
                Add New Jam
              </button>
              <button
                id="manage-venues-btn"
                class="px-6 py-2 bg-blue-500 text-white font-bold rounded-full hover:bg-blue-600 transition duration-300 shadow-md"
              >
                Manage Venues
              </button>
              <button
                class="exit-admin-btn px-4 py-2 bg-red-600 text-white font-bold rounded-full hover:bg-red-700 transition duration-300 shadow-md"
              >
                Exit Admin Mode
              </button>
            </div>
            <form
              id="add-jam-form"
              class="mt-8 p-6 bg-gray-50/50 rounded-lg shadow-inner border"
            >
              <h3 id="form-title" class="text-xl font-bold text-primary mb-4">
                Add/Edit Jam
              </h3>
              <input type="hidden" id="edit-jam-id" />
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div class="md:col-span-2">
                  <label
                    for="jam-date"
                    class="block text-gray-700 font-bold mb-2 text-left"
                    >Date</label
                  ><input
                    type="text"
                    id="jam-date"
                    class="w-full p-2 border rounded"
                    placeholder="Select a date..."
                  />
                </div>
                <div>
                  <label
                    for="jam-day"
                    class="block text-gray-700 font-bold mb-2 text-left"
                    >Day</label
                  ><input
                    type="text"
                    id="jam-day"
                    class="w-full p-2 border rounded bg-gray-200"
                    readonly
                  />
                </div>
              </div>
              <div class="mb-4">
                <label
                  for="jam-time"
                  class="block text-gray-700 font-bold mb-2 text-left"
                  >Time</label
                ><input
                  type="text"
                  id="jam-time"
                  class="w-full p-2 border rounded"
                  placeholder="Select a time..."
                />
              </div>
              <div class="mb-4">
                <label
                  for="jam-venue"
                  class="block text-gray-700 font-bold mb-2 text-left"
                  >Venue</label
                ><select
                  id="jam-venue"
                  class="w-full p-2 border rounded"
                ></select>
              </div>
              <div class="mb-4">
                <label
                  for="jam-map-link"
                  class="block text-gray-700 font-bold mb-2 text-left"
                  >Google Maps Link (Optional)</label
                ><input
                  type="url"
                  id="jam-map-link"
                  class="w-full p-2 border rounded"
                  placeholder="Paste Google Maps share link..."
                />
              </div>
              <div class="mb-4" id="rescheduled-checkbox-container" style="display: none;">
                <label class="flex items-center">
                  <input type="checkbox" id="jam-rescheduled-checkbox" class="mr-2">
                  <span class="text-gray-700 font-bold">Announce as Rescheduled</span>
                </label>
              </div>
              <div class="flex justify-end space-x-4">
                <button
                  type="button"
                  id="cancel-jam-form-btn"
                  class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"
                >
                  Cancel</button
                ><button
                  type="submit"
                  id="submit-jam-btn"
                  class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90"
                >
                  Save Jam
                </button>
              </div>
            </form>
            <div class="admin-controls mt-8 border-t pt-6 border-gray-200">
              <h4 class="text-lg font-bold text-gray-700 mb-2">
                Default Jam Day
              </h4>
              <p class="text-sm text-gray-600 mb-2">
                Set the regular day for automatically generated weekly jams.
              </p>
              <div class="flex space-x-2">
                <select id="default-day-select" class="w-full p-2 border rounded">
                </select>
                <button
                  id="save-default-day-btn"
                  class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90 whitespace-nowrap"
                >
                  Save Day
                </button>
              </div>
            </div>
            <div
              id="venue-management-section"
              class="mt-8 p-6 bg-gray-50/50 rounded-lg shadow-inner border"
            >
              <h3 class="text-xl font-bold text-primary mb-4">Manage Venues</h3>
              <ul id="venue-list-admin" class="space-y-2 mb-4"></ul>
              <form id="add-venue-form">
                <h4 class="text-lg font-bold text-primary mb-2">
                  Add New Venue
                </h4>
                <div class="mb-2">
                  <input
                    type="text"
                    id="new-venue-name"
                    class="w-full p-2 border rounded"
                    placeholder="Venue Name"
                    required
                  />
                </div>
                <div class="mb-2">
                  <input
                    type="url"
                    id="new-venue-map-link"
                    class="w-full p-2 border rounded"
                    placeholder="Google Maps Link"
                    required
                  />
                </div>
                <button
                  type="submit"
                  class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600"
                >
                  Add Venue
                </button>
              </form>
            </div>
            <div class="admin-controls mt-8 border-t pt-6 border-gray-200">
              <div class="w-full">
                <h4 class="text-lg font-bold text-gray-700 mb-2">
                  Date Testing Module
                </h4>
                <p class="text-sm text-gray-600 mb-2">
                  See how the list will look on a specific date.
                </p>
                <div class="flex space-x-2">
                  <input
                    type="text"
                    id="test-date-input"
                    class="w-full p-2 border rounded"
                    placeholder="Select a test date..."
                  /><button
                    id="test-date-btn"
                    class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 whitespace-nowrap"
                  >
                    Test Date</button
                  ><button
                    id="reset-date-btn"
                    class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"
                  >
                    Reset
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section
        id="format"
        class="py-16 md:py-20 lg:py-24 bg-stone-50 border-t border-stone-200"
      >
        <div class="container mx-auto px-4 sm:px-6">
          <h2
            class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-primary mb-12"
          >
            Our Jam Format
          </h2>
          <div
            class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center max-w-7xl mx-auto"
          >
            <div
              class="bg-white p-8 rounded-lg shadow-sm border border-stone-200"
            >
              <h3 class="font-bold text-xl text-primary mb-2">
                1. Loop Songs First
              </h3>
              <p class="text-gray-600">
                We begin with easy, repetitive songs to get everyone warmed up
                and in the groove.
              </p>
            </div>
            <div
              class="bg-white p-8 rounded-lg shadow-sm border border-stone-200"
            >
              <h3 class="font-bold text-xl text-primary mb-2">
                2. Four Chords or Less
              </h3>
              <p class="text-gray-600">
                Next, we move to songs that use four simple chords or fewer,
                making it easy for everyone to join in.
              </p>
            </div>
            <div
              class="bg-white p-8 rounded-lg shadow-sm border border-stone-200"
            >
              <h3 class="font-bold text-xl text-primary mb-2">
                3. Then Anything Goes!
              </h3>
              <p class="text-gray-600">
                In the final part of the jam, the floor is open! Bring out any
                song you'd like to play with the group.
              </p>
            </div>
          </div>
          <div class="max-w-4xl mx-auto mt-12">
            <details class="p-4 rounded-lg bg-white border border-stone-200">
              <summary class="font-bold text-lg text-primary">
                Jamming Guidelines
              </summary>
              <div
                class="mt-4 space-y-4 text-gray-700 text-left prose max-w-none"
              >
                <p class="italic">"Jamming's where the magic happens"</p>
                <p>
                  Jam circles are relaxed, open, inclusive gatherings of
                  musicians and singers who sit in a circle facing each other.
                  Jammers play for enjoyment rather than for audiences, but
                  listeners are welcome.
                </p>
                <p>A jam is a safe space to learn and grow jamming skills.</p>
                <p>
                  Jams are acoustic. Instruments such as bass and keyboards are
                  exceptions.
                </p>
                <p>
                  The most important skill that each Jammer brings to a jam is
                  their ability to listen.
                </p>
                <p>
                  Jammers play and harmonise during songs at a volume that
                  allows singers and soloists to be heard. If you can’t hear the
                  singer/soloist, reduce your volume.
                </p>
                <p>The jam circle flows in a clockwise direction.</p>
                <p>Jammers take turns to Play, Pass, or Pick.</p>
                <ul class="list-disc list-inside">
                  <li><strong>Play</strong> means to play a song.</li>
                  <li><strong>Pass</strong> means pass to the next jammer.</li>
                  <li>
                    <strong>Pick</strong> means pick a song that another jammer
                    plays.
                  </li>
                </ul>
                <p>
                  To keep the circle moving, Jammers ideally need to make their
                  choice in advance.
                </p>
                <p>
                  To respect the singer, Jammers avoid talking or
                  joining/leaving the circle mid-song.
                </p>
                <p>
                  When joining the circle, Jammers wait for their turn to play,
                  pass or pick, unless offered a turn.
                </p>
                <p>
                  Jam songs are “Jammable” i.e. they are fun, easy to play-
                  typically 3-4 chords, ideally in the same key.
                </p>
                <p>
                  A key feature of jam circles are solos or breaks -- where one
                  Jammer improvises a melody, for approximately a verse and/or
                  chorus.
                </p>
                <p>
                  Only one instrument solos at a time and Jammers don’t solo
                  over the singer.
                </p>
                <p>
                  Seasoned Jammers encourage less experienced to solo, giving
                  them ‘space to grow’.
                </p>
                <p>
                  The singer is the song leader. Jammers need to listen when
                  singers describe the song. Singers name the song, choose the
                  song key, its tempo, and during the song, they invite
                  musicians to solo and/or sing.
                </p>
                <p>
                  Any Jammer wishing to take a solo should make eye contact with
                  the singer, indicating their willingness to take a solo. They
                  start to solo when the singer gives them ‘the nod’.
                </p>
                <p>
                  The soloist stops the solo after a verse and/or a chorus,
                  attending to the singer’s signals.
                </p>
                <p>
                  The singer signals when the song is about to end, commonly by
                  lifting their instrument slightly, or raising a leg, or
                  saying, “one more time”.
                </p>
                <p>
                  Jammers tune quietly where possible, and avoid ‘noodling’
                  between or during songs.
                </p>
                <p>
                  When two or more bassists or percussionists are present, they
                  collaborate and/or alternate playing songs, using simple beats
                  and bass lines.
                </p>
                <p>
                  Please consider buying a drink if jam venues are provided
                  free.
                </p>
                <p>
                  Galway Jam Circle supports jamming for everyone, irrespective
                  of their age, ethnicity, culture, gender identity, religion,
                  language, sexual orientation, ability, disability or social
                  circumstances.
                </p>
                <p>
                  We use video and photography at our jam sessions and at
                  performances for social media. If you are uncomfortable with
                  this at a jam, please feel free to ask that you are not
                  filmed/photographed. At performances, please be advised that
                  we have no control over what audience members record.
                </p>
              </div>
            </details>
          </div>
          <div
            class="mt-12 text-center bg-accent/30 p-8 rounded-lg max-w-4xl mx-auto border border-amber-200"
          >
            <img
              src="images/lets_jam_logo.png"
              alt="Let's Jam Ireland Logo Placeholder"
              class="mx-auto mb-4 rounded-md h-20"
            />
            <p class="text-gray-700">
              Fuller information about the format and rules will be made
              available on the Let's Jam Ireland site when it is up and running.
            </p>
          </div>
        </div>
      </section>

      <section
        id="special-events"
        class="py-16 md:py-20 lg:py-24 bg-white"
      >
        <div class="container mx-auto px-4 sm:px-6">
          <h2
            class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-primary mb-4"
          >
            Festivals & Special Events
          </h2>
          <p class="text-center text-lg text-gray-600 max-w-4xl mx-auto mb-12">
            We love taking part in festivals around Ireland. Here are some of
            our favourites we've been to, and hope to see again!
          </p>

          <div class="swiper festival-carousel">
            <div class="swiper-wrapper">
              <div class="swiper-slide">
                <img
                  src="images/cleggan-fringe-festival.jpg"
                  alt="Cleggan Fringe Festival Logo"
                />
              </div>
              <div class="swiper-slide">
                <img
                  src="images/doolin-folkfest-2025.png"
                  alt="Doolin FolkFest Logo"
                />
              </div>
              <div class="swiper-slide">
                <img
                  src="images/galway-folk-festival.png"
                  alt="Galway Folk Festival Logo"
                />
              </div>
              <div class="swiper-slide">
                <img
                  src="images/westport-folk-and-bluegrass-festival.jpg"
                  alt="Westport Folk and Bluegrass Festival Logo"
                />
              </div>
              <div class="swiper-slide">
                <img
                  src="images/cahersiveen-mountain-roots.jpg"
                  alt="Cahersiveen Mountain Roots Music Weekend Logo"
                />
              </div>
            </div>
            <div class="swiper-pagination"></div>
          </div>

          <div id="event-list" class="max-w-4xl mx-auto space-y-8 mt-12"></div>
          <div class="text-center mt-8 admin-controls-inline">
            <button
              id="add-event-btn"
              class="px-6 py-2 bg-green-500 text-white font-bold rounded-full hover:bg-green-600 transition duration-300 shadow-md"
            >
              Add New Event
            </button>
          </div>
          <form
            id="add-event-form"
            class="max-w-4xl mx-auto mt-8 p-6 bg-gray-50/50 rounded-lg shadow-inner border"
          >
            <h3
              id="event-form-title"
              class="text-xl font-bold text-primary mb-4"
            >
              Add a New Event
            </h3>
            <input type="hidden" id="edit-event-id" />
            <div class="mb-4">
              <label
                for="event-title"
                class="block text-gray-700 font-bold mb-2 text-left"
                >Title</label
              >
              <input
                type="text"
                id="event-title"
                class="w-full p-2 border rounded"
                placeholder="e.g., Cleggan Fringe Festival"
                required
              />
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label
                  for="event-dates"
                  class="block text-gray-700 font-bold mb-2 text-left"
                  >Date(s)</label
                >
                <input
                  type="text"
                  id="event-dates"
                  class="w-full p-2 border rounded"
                  placeholder="Select a date or date range..."
                  required
                />
              </div>
              <div>
                <label
                  for="event-time"
                  class="block text-gray-700 font-bold mb-2 text-left"
                  >Time (Optional)</label
                >
                <input
                  type="text"
                  id="event-time"
                  class="w-full p-2 border rounded"
                  placeholder="e.g., 6:00 PM - 8:00 PM"
                />
              </div>
            </div>
            <div class="mb-4">
              <label
                for="event-map-link"
                class="block text-gray-700 font-bold mb-2 text-left"
                >Google Maps Link (Optional)</label
              >
              <input
                type="url"
                id="event-map-link"
                class="w-full p-2 border rounded"
                placeholder="Paste Google Maps share link..."
              />
            </div>
            <div class="mb-4">
              <label
                for="event-description"
                class="block text-gray-700 font-bold mb-2 text-left"
                >Description</label
              >
              <textarea
                id="event-description"
                class="w-full p-2 border rounded"
                rows="4"
                placeholder="Enter event details..."
                required
              ></textarea>
            </div>
            <div class="flex justify-end space-x-4">
              <button
                type="button"
                id="cancel-event-btn"
                class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"
              >
                Cancel
              </button>
              <button
                type="submit"
                id="submit-event-btn"
                class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90"
              >
                Save Event
              </button>
            </div>
          </form>
        </div>
      </section>

      <section id="community" class="py-16 md:py-20 lg:py-24 bg-stone-50 border-t border-stone-200">
        <div class="container mx-auto px-4 sm:px-6">
          <h2
            class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-primary mb-4"
          >
            Community & Charity
          </h2>
          <p class="text-center text-lg text-gray-600 max-w-4xl mx-auto mb-12">
            We're proud to be part of the Galway community and support local
            causes. Here are some of the events and fundraisers we've been
            involved with.
          </p>

          <div id="community-slider-container" class="max-w-5xl mx-auto">
            <div class="swiper community-swiper">
              <div class="swiper-wrapper" id="community-swiper-wrapper"></div>
              <div class="swiper-button-next"></div>
              <div class="swiper-button-prev"></div>
              <div class="swiper-pagination"></div>
            </div>
          </div>

          <div class="text-center mt-8 admin-controls-inline">
            <button
              id="add-community-item-btn"
              class="px-6 py-2 bg-green-500 text-white font-bold rounded-full hover:bg-green-600 transition duration-300 shadow-md"
            >
              Add New Item
            </button>
          </div>

          <form
            id="add-community-form"
            class="max-w-3xl mx-auto mt-8 p-6 bg-gray-50/50 rounded-lg shadow-inner border"
          >
            <h3
              id="community-form-title"
              class="text-xl font-bold text-primary mb-4"
            >
              Add New Community/Charity Item
            </h3>
            <input type="hidden" id="edit-community-id" />
            <div class="mb-4">
              <label
                for="community-image-url"
                class="block text-gray-700 font-bold mb-2 text-left"
                >Image URL</label
              >
              <input
                type="url"
                id="community-image-url"
                class="w-full p-2 border rounded"
                placeholder="Paste direct image link..."
                required
              />
            </div>
            <div class="mb-4">
              <label
                for="community-item-type"
                class="block text-gray-700 font-bold mb-2 text-left"
                >Item Type</label
              >
              <select
                id="community-item-type"
                class="w-full p-2 border rounded"
              >
                <option value="community">Community Event</option>
                <option value="charity">Charity Fundraiser</option>
              </select>
            </div>

            <div id="community-headline-wrapper" class="mb-4 hidden">
              <label
                for="community-headline"
                class="block text-gray-700 font-bold mb-2 text-left"
                >Headline</label
              >
              <input
                type="text"
                id="community-headline"
                class="w-full p-2 border rounded"
                placeholder="e.g., Music for the Community Fair"
              />
            </div>
            <div id="charity-fields-wrapper" class="hidden">
              <div class="mb-4">
                <label
                  for="community-amount"
                  class="block text-gray-700 font-bold mb-2 text-left"
                  >Amount Raised</label
                >
                <input
                  type="text"
                  id="community-amount"
                  class="w-full p-2 border rounded"
                  placeholder="e.g., €1,200"
                />
              </div>
              <div class="mb-4">
                <label
                  for="community-charity-name"
                  class="block text-gray-700 font-bold mb-2 text-left"
                  >For (Charity Name)</label
                >
                <input
                  type="text"
                  id="community-charity-name"
                  class="w-full p-2 border rounded"
                  placeholder="e.g., COPE Galway"
                />
              </div>
            </div>

            <div class="mb-4">
              <label
                for="community-description"
                class="block text-gray-700 font-bold mb-2 text-left"
                >Description (max 40 words)</label
              >
              <textarea
                id="community-description"
                class="w-full p-2 border rounded"
                rows="3"
                placeholder="A short description of the event or fundraiser..."
                maxlength="240"
              ></textarea>
            </div>

            <div class="flex justify-end space-x-4">
              <button
                type="button"
                id="cancel-community-btn"
                class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"
              >
                Cancel
              </button>
              <button
                type="submit"
                class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90"
              >
                Save Item
              </button>
            </div>
          </form>
        </div>
      </section>

      <section
        id="gallery"
        class="py-16 md:py-20 lg:py-24 bg-white border-y border-stone-200"
      >
        <div class="container mx-auto px-4 sm:px-6">
          <h2
            class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-primary mb-12"
          >
            Jam Circle Gallery
          </h2>

          <h3
            class="text-2xl md:text-3xl font-bold text-center text-primary mb-8"
          >
            Videos
          </h3>
          <div class="max-w-5xl mx-auto">
            <div class="relative" style="padding-bottom: 56.25%; height: 0">
              <iframe
                id="featured-video-player"
                class="absolute top-0 left-0 w-full h-full rounded-lg shadow-lg"
                src=""
                title="YouTube video player"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
              ></iframe>
            </div>
          </div>
          <div class="text-center mt-8 admin-controls-inline">
            <button
              id="edit-featured-video-btn"
              class="px-4 py-2 bg-blue-500 text-white font-bold rounded-full hover:bg-blue-600 transition duration-300 shadow-md"
            >
              Change Featured Video
            </button>
          </div>
          <div class="text-center mt-8">
            <a
              href="https://youtube.com/playlist?list=PLG9xaR5hTnatoLYd337wPFrbVkjHmWErw"
              target="_blank"
              class="inline-block px-8 py-3 bg-accent text-primary font-bold rounded-full hover:bg-opacity-80 transition duration-300 shadow-md"
            >
              See our YouTube Channel
            </a>
          </div>
          <form
            id="edit-featured-video-form"
            class="max-w-xl mx-auto mt-4 p-6 bg-white rounded-lg shadow-xl border border-gray-200"
          >
            <h3 class="text-xl font-bold text-primary mb-4">
              Change Featured Video
            </h3>
            <div class="mb-4">
              <label
                for="featured-video-url"
                class="block text-gray-700 font-bold mb-2 text-left"
                >New YouTube Video URL</label
              >
              <input
                type="url"
                id="featured-video-url"
                class="w-full p-2 border rounded"
                placeholder="Paste YouTube video link..."
              />
            </div>
            <div class="flex justify-end space-x-4">
              <button
                type="button"
                id="cancel-featured-video-btn"
                class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"
              >
                Cancel
              </button>
              <button
                type="submit"
                class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90"
              >
                Save Video
              </button>
            </div>
          </form>

          <h3
            class="text-2xl md:text-3xl font-bold text-center text-primary mt-16 mb-8"
          >
            Photos
          </h3>
          <div
            id="gallery-grid"
            class="grid grid-cols-2 md:grid-cols-3 gap-4"
          ></div>
          <div class="text-center mt-8 admin-controls-inline">
            <button
              id="add-photo-btn"
              class="px-6 py-2 bg-green-500 text-white font-bold rounded-full hover:bg-green-600 transition duration-300 shadow-md"
            >
              Add Photo
            </button>
          </div>
          <form
            id="add-photo-form"
            class="max-w-3xl mx-auto mt-8 p-6 bg-white rounded-lg shadow-inner border"
          >
            <h3 class="text-xl font-bold text-primary mb-4">Add New Photo</h3>
            <div class="mb-4">
              <label
                for="photo-url"
                class="block text-gray-700 font-bold mb-2 text-left"
                >Photo URL</label
              >
              <input
                type="url"
                id="photo-url"
                class="w-full p-2 border rounded"
                placeholder="Paste direct image link..."
                required
              />
            </div>
            <div class="mb-4">
              <label
                for="photo-caption"
                class="block text-gray-700 font-bold mb-2 text-left"
                >Caption (Alt Text)</label
              >
              <input
                type="text"
                id="photo-caption"
                class="w-full p-2 border rounded"
                placeholder="e.g., Jam session by the river"
                required
              />
            </div>
            <div class="flex justify-end space-x-4">
              <button
                type="button"
                id="cancel-photo-btn"
                class="px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600"
              >
                Cancel
              </button>
              <button
                type="submit"
                id="submit-photo-btn"
                class="px-4 py-2 bg-primary text-white rounded-md hover:opacity-90"
              >
                Save Photo
              </button>
            </div>
          </form>
        </div>
      </section>

      <section id="contact" class="py-16 md:py-20 lg:py-24 bg-white">
        <div class="container mx-auto px-4 sm:px-6 text-center">
          <h2
            class="text-3xl md:text-4xl lg:text-5xl font-bold text-center text-primary mb-4"
          >
            Join Us!
          </h2>
          <p class="text-lg text-gray-600 max-w-3xl mx-auto mb-8">
            Want to join our mailing list for updates or have a question? Get in
            touch! We'd love to hear from you.
          </p>
          <a
            href="mailto:info@galwayjamcircle.ie"
            class="px-8 py-3 bg-primary text-white font-bold rounded-full hover:opacity-90 transition duration-300 transform hover:scale-105 shadow-md"
            >Email Us</a
          >
        </div>
      </section>
    </main>

    <footer class="bg-primary text-white/80 py-8">
      <div class="container mx-auto px-6 text-center">
        <div class="flex justify-center items-start space-x-6 mb-4">
          <div class="text-center">
            <a
              href="https://www.facebook.com/groups/116675615376726"
              target="_blank"
              class="text-white hover:text-accent transition duration-300"
            >
              <svg
                class="w-6 h-6 mx-auto mb-1"
                fill="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  fill-rule="evenodd"
                  d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33V21.878A10.001 10.001 0 0022 12z"
                  clip-rule="evenodd"
                />
              </svg>
              <span class="text-xs">Group</span>
            </a>
          </div>
          <div class="text-center">
            <a
              href="https://www.facebook.com/profile.php?id=61570031297498"
              target="_blank"
              class="text-white hover:text-accent transition duration-300"
            >
              <svg
                class="w-6 h-6 mx-auto mb-1"
                fill="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
              >
                <path
                  fill-rule="evenodd"
                  d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33V21.878A10.001 10.001 0 0022 12z"
                  clip-rule="evenodd"
                />
              </svg>
              <span class="text-xs">Page</span>
            </a>
          </div>
          <a
            href="https://www.instagram.com/galwayjamcircle42/?hl=en"
            target="_blank"
            class="text-white hover:text-accent transition duration-300 pt-1"
          >
            <svg
              class="w-6 h-6"
              fill="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                fill-rule="evenodd"
                d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.024.048-1.378.06-3.808.06s-2.784-.012-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.048-1.024-.06-1.378-.06-3.808s.012-2.784.06-3.808c.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 016.345 2.525c.636-.247 1.363-.416 2.427-.465C9.792 2.013 10.146 2 12.315 2zm0 1.623c-2.403 0-2.748.01-3.728.058-1.006.047-1.634.21-2.203.434a3.272 3.272 0 00-1.15 1.15c-.224.57-.386 1.198-.434 2.203-.048.98-.058 1.325-.058 3.728s.01 2.748.058 3.728c.048 1.006.21 1.634.434 2.203a3.272 3.272 0 001.15 1.15c.57.224 1.198.386 2.203.434.98.048 1.325.058 3.728.058s2.748-.01 3.728-.058c1.006-.047 1.634-.21 2.203-.434a3.272 3.272 0 001.15-1.15c.224-.57.386-1.198.434-2.203.048-.98.058-1.325.058-3.728s-.01-2.748-.058-3.728c-.048-1.006-.21-1.634-.434-2.203a3.272 3.272 0 00-1.15-1.15c-.57-.224-1.198-.386-2.203-.434C15.063 3.633 14.718 3.623 12.315 3.623zM12 9.75a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5zm0 6a3.75 3.75 0 110-7.5 3.75 3.75 0 010 7.5zM16.965 6.57a1.125 1.125 0 100 2.25 1.125 1.125 0 000-2.25z"
                clip-rule="evenodd"
              />
            </svg>
          </a>
        </div>
        <p>© 2025 Galway Jam Circle. v2.0. All Rights Reserved.</p>
        <p class="text-sm text-stone-400 mt-2">
          Bringing music to the people of Galway.
        </p>
        <div class="space-x-4">
          <a
            href="feedback.html"
            class="text-sm text-stone-400 hover:text-white mt-4 inline-block"
            >Website Feedback</a
          >
          <a
            href="#"
            id="admin-mode-btn"
            class="text-sm text-stone-400 hover:text-white mt-4 inline-block"
            >Admin</a
          >
        </div>
      </div>
    </footer>

    <div
      id="custom-modal"
      class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center"
    >
      <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
        <p id="modal-message" class="text-lg mb-4"></p>
        <input
          type="password"
          id="modal-input"
          class="w-full p-2 border rounded mb-4 hidden"
          placeholder="Enter password..."
        />
        <div id="modal-buttons" class="flex justify-end space-x-4"></div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
        doc,
        setDoc,
        deleteDoc,
        writeBatch,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyC4SnqaOMQWmEFulkN8zZALZsqJLK7hOh0",
        authDomain: "galway-jam-circle-live.firebaseapp.com",
        projectId: "galway-jam-circle-live",
        storageBucket: "galway-jam-circle-live.appspot.com",
        messagingSenderId: "140452021164",
        appId: "1:140452021164:web:69703d13213d4ce49a3009",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      document.addEventListener("DOMContentLoaded", async () => {
        // --- GLOBAL STATE & CONSTANTS ---
        const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
        let initialJams = [], initialEvents = [], initialPhotos = [], initialVenues = [], initialCommunityItems = [];
        let jams = [], events = [], photos = [], communityItems = [];
        let communitySwiper = null;
        let jamDatePicker, jamTimePicker, eventDatePicker, testDatePicker;
        let defaultJamDay = "Saturday";

        // --- DOM ELEMENT DECLARATIONS ---
        const coverPhotoElement = document.getElementById("cover-photo");
        const jamList = document.getElementById("jam-list");
        const addJamForm = document.getElementById("add-jam-form");
        const jamDateInput = document.getElementById("jam-date");
        const jamDayInput = document.getElementById("jam-day");
        const jamTimeInput = document.getElementById("jam-time");
        const jamVenueInput = document.getElementById("jam-venue");
        const jamMapLinkInput = document.getElementById("jam-map-link");
        const rescheduledCheckboxContainer = document.getElementById("rescheduled-checkbox-container");
        const rescheduledCheckbox = document.getElementById("jam-rescheduled-checkbox");
        const editJamIdInput = document.getElementById("edit-jam-id");
        const formTitle = document.getElementById("form-title");
        const defaultDaySelect = document.getElementById("default-day-select");
        const venueManagementSection = document.getElementById("venue-management-section");
        const venueListAdmin = document.getElementById("venue-list-admin");
        const addVenueForm = document.getElementById("add-venue-form");
        const newVenueNameInput = document.getElementById("new-venue-name");
        const newVenueMapLinkInput = document.getElementById("new-venue-map-link");
        const eventList = document.getElementById("event-list");
        const addEventForm = document.getElementById("add-event-form");
        const eventTitleInput = document.getElementById("event-title");
        const eventDatesInput = document.getElementById("event-dates");
        const eventTimeInput = document.getElementById("event-time");
        const eventMapLinkInput = document.getElementById("event-map-link");
        const eventDescriptionInput = document.getElementById("event-description");
        const editEventIdInput = document.getElementById("edit-event-id");
        const eventFormTitle = document.getElementById("event-form-title");
        const galleryGrid = document.getElementById("gallery-grid");
        const addPhotoForm = document.getElementById("add-photo-form");
        const photoUrlInput = document.getElementById("photo-url");
        const photoCaptionInput = document.getElementById("photo-caption");
        const featuredVideoPlayer = document.getElementById("featured-video-player");
        const editFeaturedVideoForm = document.getElementById("edit-featured-video-form");
        const featuredVideoUrlInput = document.getElementById("featured-video-url");
        const editCoverPhotoForm = document.getElementById("edit-cover-photo-form");
        const coverPhotoUrlInput = document.getElementById("cover-photo-url");
        const communitySwiperWrapper = document.getElementById("community-swiper-wrapper");
        const addCommunityForm = document.getElementById("add-community-form");
        const editCommunityIdInput = document.getElementById("edit-community-id");
        const communityImageUrlInput = document.getElementById("community-image-url");
        const communityItemTypeInput = document.getElementById("community-item-type");
        const communityDescriptionInput = document.getElementById("community-description");
        const communityHeadlineWrapper = document.getElementById("community-headline-wrapper");
        const communityHeadlineInput = document.getElementById("community-headline");
        const charityFieldsWrapper = document.getElementById("charity-fields-wrapper");
        const communityAmountInput = document.getElementById("community-amount");
        const communityCharityNameInput = document.getElementById("community-charity-name");
        const communityFormTitle = document.getElementById("community-form-title");
        const modal = document.getElementById("custom-modal");
        const modalMessage = document.getElementById("modal-message");
        const modalInput = document.getElementById("modal-input");
        const modalButtons = document.getElementById("modal-buttons");
        const testDateInput = document.getElementById("test-date-input");

        // --- UTILITY & FORMATTING FUNCTIONS ---
        function parseJamDate(dateStr) {
          const year = new Date().getFullYear();
          const dateWithYear = dateStr.replace(":", "").trim() + ` ${year}`;
          let parsedDate = new Date(dateWithYear);
          if (parsedDate < new Date() && new Date().getMonth() - parsedDate.getMonth() > 6) {
             parsedDate.setFullYear(year + 1);
          }
          return parsedDate;
        }

        function formatJamDateForDisplay(dateObj) {
            return `${dateObj.getDate()} ${dateObj.toLocaleString("default", { month: "short" })}`;
        }

        function formatJamDateForStorage(dateObj) {
            return `${formatJamDateForDisplay(dateObj)}:`;
        }
        
        function formatTime(timeStr) {
            if (!timeStr || !timeStr.includes(':')) return timeStr;
            const parts = timeStr.match(/(\d+):(\d+)\s*(AM|PM)?/i);
            if (!parts) return timeStr;

            let hours = parseInt(parts[1], 10);
            const minutes = parseInt(parts[2], 10);
            let ampm = parts[3] ? parts[3].toUpperCase() : (hours >= 12 ? 'PM' : 'AM');

            if (hours > 12) {
              hours -= 12;
            } else if (hours === 0) {
              hours = 12;
            }
            
            return `${hours}:${minutes.toString().padStart(2, '0')} ${ampm}`;
        }

        // --- INITIALIZATION ---
        function initDatePickers() {
            jamDatePicker = flatpickr(jamDateInput, {
              dateFormat: "j M Y",
              onChange: (selectedDates) => {
                  if (selectedDates.length > 0) {
                      jamDayInput.value = dayNames[selectedDates[0].getDay()];
                  }
              },
            });
            jamTimePicker = flatpickr(jamTimeInput, {
              enableTime: true,
              noCalendar: true,
              dateFormat: "h:i K",
              defaultDate: "3:00 PM",
              disableMobile: true, // Fix for mobile usability
            });
            eventDatePicker = flatpickr(eventDatesInput, {
              mode: "range",
              dateFormat: "j M Y",
               onClose: (selectedDates, dateStr, instance) => {
                    if (selectedDates.length === 1) {
                        const date = selectedDates[0];
                        instance.input.value = `${dayNames[date.getDay()]}, ${date.getDate()} ${date.toLocaleString("default", { month: "short" })} ${date.getFullYear()}`;
                    } else if (selectedDates.length === 2) {
                        const start = selectedDates[0];
                        const end = selectedDates[1];
                        const format = (date) => `${dayNames[date.getDay()]}, ${date.getDate()} ${date.toLocaleString("default", { month: "short" })}`;
                        instance.input.value = `${format(start)} - ${format(end)} ${end.getFullYear()}`;
                    }
               }
            });
            testDatePicker = flatpickr(testDateInput, { dateFormat: "Y-m-d" });
        }
        
        function initCarousels() {
             new Swiper(".festival-carousel", {
                loop: true,
                autoplay: { delay: 4000, disableOnInteraction: false },
                pagination: { el: ".swiper-pagination", clickable: true },
                slidesPerView: 2,
                spaceBetween: 20,
                breakpoints: {
                    640: { slidesPerView: 3, spaceBetween: 30 },
                    1024: { slidesPerView: 5, spaceBetween: 50 },
                },
            });

            if (communitySwiper) communitySwiper.destroy(true, true);
            communitySwiper = new Swiper(".community-swiper", {
              effect: "fade",
              fadeEffect: { crossFade: true },
              loop: communityItems.length > 1,
              autoplay: { delay: 6000, disableOnInteraction: false },
              pagination: { el: ".swiper-pagination", clickable: true },
              navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
              },
            });
        }
        
        // --- DATA SEEDING ---
        async function seedDatabaseIfEmpty() {
          if (initialJams.length === 0 && initialVenues.length === 0 && initialPhotos.length === 0) {
             console.log("Database is empty. Seeding with initial data...");
             const batch = writeBatch(db);

             const seedVenues = [
                { id: '1', name: 'The Crane Bar', mapLink: 'https://maps.app.goo.gl/gQj1b7qE9fR2cW9x6' },
                { id: '2', name: "O'Connor's Famous Pub", mapLink: 'https://maps.app.goo.gl/kX7sC3Z7wB6Y4p7Y8' },
                { id: '3', name: 'Spanish Arch', mapLink: 'https://maps.app.goo.gl/VjS1Ua3sH6A2pZqKA' },
             ];

             const seedJams = [
                { id: '1672531200000', date: '10 Aug:', day: 'Saturday', time: '3:00 PM', venue: 'The Crane Bar', mapLink: 'https://maps.app.goo.gl/gQj1b7qE9fR2cW9x6', cancelled: false, isRescheduled: false },
                { id: '1673136000000', date: '17 Aug:', day: 'Saturday', time: '3:00 PM', venue: "O'Connor's Famous Pub", mapLink: 'https://maps.app.goo.gl/kX7sC3Z7wB6Y4p7Y8', cancelled: false, isRescheduled: false },
             ];
              
             const seedPhotos = [
                { id: '1', url: 'https://scontent-dub4-1.xx.fbcdn.net/v/t39.30808-6/441940984_467137352462375_2069542030018448903_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=a5f93a&_nc_ohc=fV0i_X2yHcoQ7kNvgFYexA-&_nc_ht=scontent-dub4-1.xx&oh=00_AYBv6u6U1cGNw3vC5u2O-iX2o2oY0X7B9d0b6w0u0g3J3w&oe=6686A3E9', caption: 'A jam session in a cozy pub.' },
                { id: '2', url: 'https://scontent-dub4-1.xx.fbcdn.net/v/t39.30808-6/438440571_449339904242120_3534936330999086105_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=a5f93a&_nc_ohc=y7m8R0o-mE8Q7kNvgEwXo0C&_nc_ht=scontent-dub4-1.xx&oh=00_AYDXu2-c2c3b8t-5H6O3S1c-Y0Q8X3r-o0V1g3A3E2u2Fw&oe=66869408', caption: 'Musicians playing together outdoors.' },
             ];

             const seedCommunityItems = [
                { id: '1', type: 'charity', imageUrl: 'https://scontent-dub4-1.xx.fbcdn.net/v/t39.30808-6/434110825_433552092487568_1978257008516886427_n.jpg?_nc_cat=109&ccb=1-7&_nc_sid=a5f93a&_nc_ohc=p-n-G9M9hK4Q7kNvgGfX-Y1&_nc_ht=scontent-dub4-1.xx&oh=00_AYD7o-d2Z0f0j-L9f3a1H9c-w8b6f3o2o2Z2y0G0u1g1iA&oe=668695E6', description: 'We had a great time busking for COPE Galway, raising vital funds for their services.', amountRaised: '€750', charityName: 'COPE Galway' },
             ];

             seedVenues.forEach(venue => batch.set(doc(db, "venues", venue.id), venue));
             seedJams.forEach(jam => batch.set(doc(db, "jams", jam.id), jam));
             seedPhotos.forEach(photo => batch.set(doc(db, "photos", photo.id), photo));
             seedCommunityItems.forEach(item => batch.set(doc(db, "community", item.id), item));
              
             await batch.commit();
             await loadData(); // Reload data after seeding
          }
        }

        // --- CORE LOGIC & RENDERING ---
        function manageJamSchedule(testDateStr = null) {
            const today = testDateStr ? new Date(testDateStr) : new Date();
            today.setHours(0, 0, 0, 0);

            let confirmedJams = JSON.parse(JSON.stringify(initialJams));
            
            let upcomingConfirmed = confirmedJams.filter(jam => {
                const jamDate = parseJamDate(jam.date);
                return jamDate && jamDate >= today;
            });
            
            // Sort upcoming jams by date to find the last one correctly
            upcomingConfirmed.sort((a, b) => parseJamDate(a.date) - parseJamDate(b.date));

            let displayJams = [...upcomingConfirmed];
            let lastDate;

            if (displayJams.length > 0) {
                lastDate = parseJamDate(displayJams[displayJams.length - 1].date);
            } else {
                lastDate = new Date(today);
                const targetDayIndex = dayNames.indexOf(defaultJamDay);
                let currentDayIndex = today.getDay();
                let daysUntilTarget = (targetDayIndex - currentDayIndex + 7) % 7;
                lastDate.setDate(today.getDate() + daysUntilTarget);
                // Start generating from the week before the first placeholder
                lastDate.setDate(lastDate.getDate() - 7);
            }

            while (displayJams.length < 5) {
                lastDate.setDate(lastDate.getDate() + 7);
                // Ensure we don't add a placeholder that already has a confirmed event
                const formattedNewDate = formatJamDateForStorage(new Date(lastDate));
                if (displayJams.some(j => j.date === formattedNewDate)) continue;

                displayJams.push({
                    id: `placeholder-${displayJams.length}`,
                    day: defaultJamDay,
                    date: formattedNewDate,
                    venue: "To be decided...",
                    cancelled: false,
                    isPlaceholder: true,
                    time: "3:00 PM",
                });
            }
            jams = displayJams;
        }

        function renderJams() {
            jamList.innerHTML = "";
            if (jams.length === 0) {
              jamList.innerHTML = `<li class="text-center text-gray-500">No upcoming jams scheduled.</li>`;
              return;
            }
            
            jams.sort((a, b) => parseJamDate(a.date) - parseJamDate(b.date)).forEach(jam => {
                const li = document.createElement("li");
                const isSpecial = jam.isRescheduled || jam.day.toLowerCase() !== defaultJamDay.toLowerCase();

                li.className = "p-4 rounded-lg shadow-sm border-l-4 flex flex-col sm:flex-row sm:justify-between items-start sm:items-center bg-white border-gray-200";
                li.classList.toggle("jam-special", isSpecial);
                li.classList.toggle("jam-cancelled", jam.cancelled);
                
                let adminButtons = '';
                if (!jam.isPlaceholder) {
                   adminButtons += `<button data-id="${jam.id}" class="edit-btn text-blue-500 hover:text-blue-700">Edit</button>`;
                   if (isSpecial) {
                      adminButtons += `<button data-id="${jam.id}" class="delete-btn text-red-500 hover:text-red-700 ml-2">Delete</button>`;
                   } else {
                      adminButtons += jam.cancelled
                        ? `<button data-id="${jam.id}" class="reinstate-btn text-green-600 hover:text-green-800 ml-2">Reinstate</button>`
                        : `<button data-id="${jam.id}" class="cancel-btn text-yellow-600 hover:text-yellow-800 ml-2">Cancel</button>`;
                   }
                }
                
                const mapLink = jam.mapLink ? ` <a href="${jam.mapLink}" target="_blank" class="text-blue-500 hover:underline whitespace-nowrap">(Map)</a>` : "";
                const statusHTML = jam.cancelled ? `<span class="font-bold text-red-600">(CANCELLED)</span>` : (jam.isRescheduled ? `<span class="font-bold text-violet-600">(Rescheduled)</span>` : '');

                li.innerHTML = `
                    <div class="flex-grow jam-info">
                        <div class="flex flex-col sm:flex-row sm:items-baseline sm:space-x-2">
                            <span class="font-bold text-lg ${isSpecial ? 'text-violet-600' : 'text-gray-500'}">${jam.day}</span>
                            <span class="text-lg font-bold text-primary">${formatJamDateForDisplay(parseJamDate(jam.date))}</span>
                            <span class="text-lg font-bold text-gray-600">${formatTime(jam.time || "3:00 PM")}</span>
                        </div>
                        <span class="text-gray-700 text-lg">${jam.venue}${mapLink}</span>
                    </div>
                    <div class="flex flex-col items-end justify-between self-stretch mt-2 sm:mt-0">
                         ${statusHTML}
                        <div class="admin-controls-inline space-x-2 mt-2 sm:mt-0">${adminButtons}</div>
                    </div>
                `;
                jamList.appendChild(li);
            });
        }
        
        function renderVenues() {
            venueListAdmin.innerHTML = "";
            initialVenues.sort((a, b) => a.name.localeCompare(b.name)).forEach(venue => {
                const li = document.createElement("li");
                li.className = "flex justify-between items-center p-2 bg-white rounded";
                li.innerHTML = `
                    <span>${venue.name}</span>
                    <button data-id="${venue.id}" class="delete-venue-btn text-red-500 hover:text-red-700">Delete</button>
                `;
                venueListAdmin.appendChild(li);
            });
        }
        
        function renderEvents() {
            eventList.innerHTML = "";
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const upcomingEvents = initialEvents.filter(event => {
                const dateString = event.dates.includes("-") ? event.dates.split("-")[1].trim() : event.dates;
                const eventEndDate = new Date(dateString);
                return eventEndDate >= today;
            });
            
            if (upcomingEvents.length === 0) {
                eventList.innerHTML = `<p class="text-center text-gray-500">No special events scheduled at this time.</p>`;
            }

            upcomingEvents.sort((a,b) => new Date(a.dates.split("-")[0].trim()) - new Date(b.dates.split("-")[0].trim())).forEach(event => {
                const div = document.createElement("div");
                div.className = "bg-white p-6 rounded-lg shadow-md relative border border-gray-200";
                const timeHTML = event.time ? `<span class="text-gray-600 font-semibold">${event.time}</span>` : "";
                const mapLinkHTML = event.mapLink ? ` <a href="${event.mapLink}" target="_blank" class="text-blue-500 hover:underline whitespace-nowrap">(Map)</a>` : "";
                div.innerHTML = `
                    <div class="admin-controls-inline absolute top-2 right-2 space-x-2">
                        <button data-id="${event.id}" class="edit-event-btn text-blue-500 hover:text-blue-700">Edit</button>
                        <button data-id="${event.id}" class="delete-event-btn text-red-500 hover:text-red-700">Delete</button>
                    </div>
                    <h3 class="text-2xl font-bold text-primary">${event.title}</h3>
                    <div class="flex items-center space-x-4 mt-1">
                        <p class="text-lg font-semibold text-gray-700">${event.dates}</p>
                        ${timeHTML}${mapLinkHTML}
                    </div>
                    <p class="mt-4 text-gray-600">${event.description}</p>
                `;
                eventList.appendChild(div);
            });
        }
        
        function renderGallery() {
            galleryGrid.innerHTML = "";
            photos = [...initialPhotos];
            if (photos.length === 0) {
                galleryGrid.innerHTML = `<p class="text-center text-gray-500 col-span-full">The photo gallery is empty. Add some photos!</p>`;
                return;
            }
            photos.forEach(photo => {
                const div = document.createElement("div");
                div.className = "gallery-item overflow-hidden rounded-lg shadow-lg";
                div.innerHTML = `
                    <img src="${photo.url}" alt="${photo.caption}" class="w-full h-full object-cover transform hover:scale-110 transition duration-500">
                    <button data-id="${photo.id}" class="delete-photo-btn admin-controls-inline bg-red-500 text-white rounded-full p-1 hover:bg-red-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </button>
                `;
                galleryGrid.appendChild(div);
            });
        }

        function renderCommunitySlider() {
            communityItems = [...initialCommunityItems];
            communitySwiperWrapper.innerHTML = "";
            if (communityItems.length === 0) {
                communitySwiperWrapper.innerHTML = `<div class="swiper-slide flex items-center justify-center bg-gray-100 text-gray-500 p-4 rounded-lg">No community events to show.</div>`;
            } else {
                communityItems.forEach(item => {
                    const slide = document.createElement("div");
                    slide.className = "swiper-slide";
                    let headlineHTML = "";
                    if (item.type === "charity" && item.amountRaised && item.charityName) {
                        headlineHTML = `<h3 class="font-bold text-primary text-xl mb-2">Amount Raised: ${item.amountRaised} for ${item.charityName}</h3>`;
                    } else if (item.type === "community" && item.headline) {
                        headlineHTML = `<h3 class="font-bold text-primary text-xl mb-2">${item.headline}</h3>`;
                    }
                    slide.innerHTML = `
                        <div class="bg-white overflow-hidden border border-gray-200 h-full">
                            <div class="relative community-image-container">
                                <img src="${item.imageUrl}" alt="${item.description.substring(0,50)}">
                                <div class="slide-admin-controls admin-controls-inline space-x-2">
                                    <button data-id="${item.id}" class="edit-community-btn bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 shadow-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg></button>
                                    <button data-id="${item.id}" class="delete-community-btn bg-red-500 text-white p-2 rounded-full hover:bg-red-600 shadow-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg></button>
                                </div>
                            </div>
                            <div class="p-6">${headlineHTML}<p class="text-gray-600">${item.description}</p></div>
                        </div>`;
                    communitySwiperWrapper.appendChild(slide);
                });
            }
            initCarousels();
        }

        // --- FORM HANDLING ---
        function showJamForm(mode = "add", jam = null) {
            addJamForm.style.display = "block";
            addJamForm.scrollIntoView({ behavior: "smooth", block: "center" });

            jamVenueInput.innerHTML = "";
            initialVenues.forEach(venue => {
                const option = document.createElement("option");
                option.value = venue.name;
                option.textContent = venue.name;
                jamVenueInput.appendChild(option);
            });
            
            if (mode === "edit" && jam) {
                formTitle.textContent = "Edit Jam";
                editJamIdInput.value = jam.id;
                jamDatePicker.setDate(parseJamDate(jam.date), true);
                jamDayInput.value = jam.day;
                jamTimePicker.setDate(jam.time || "3:00 PM", true);
                jamVenueInput.value = jam.venue;
                jamMapLinkInput.value = jam.mapLink || "";
                rescheduledCheckbox.checked = jam.isRescheduled || false;
                rescheduledCheckboxContainer.style.display = 'block';

            } else {
                formTitle.textContent = "Add a New Jam";
                addJamForm.reset();
                editJamIdInput.value = "";
                rescheduledCheckboxContainer.style.display = 'none';
                const lastJamDate = jams.length > 0 ? parseJamDate(jams[jams.length - 1].date) : new Date();
                lastJamDate.setDate(lastJamDate.getDate() + 7);
                jamDatePicker.setDate(lastJamDate, true);
            }
        }
        function hideAllForms() {
            addJamForm.style.display = "none";
            venueManagementSection.style.display = "none";
            addEventForm.style.display = "none";
            addPhotoForm.style.display = "none";
            addCommunityForm.style.display = "none";
            editCoverPhotoForm.style.display = "none";
            editFeaturedVideoForm.style.display = "none";
        }
        
        // --- EVENT LISTENERS ---
        function setupEventListeners() {
            // Mobile Menu
            document.getElementById("menu-btn").addEventListener("click", () => document.getElementById("mobile-menu").classList.toggle("hidden"));
            document.querySelectorAll("#mobile-menu a").forEach(link => link.addEventListener("click", () => document.getElementById("mobile-menu").classList.add("hidden")));

            // Admin Mode
            document.getElementById("admin-mode-btn").addEventListener("click", handleAdminClick);
            document.body.addEventListener("click", (e) => {
              if (e.target.classList.contains("exit-admin-btn")) {
                sessionStorage.removeItem("gjc_isAdmin");
                toggleAdminMode(false);
              }
            });

            // Jam Section
            document.getElementById("add-jam-btn").addEventListener("click", () => showJamForm("add"));
            document.getElementById("cancel-jam-form-btn").addEventListener("click", () => addJamForm.style.display = 'none');
            addJamForm.addEventListener("submit", handleJamFormSubmit);
            jamList.addEventListener("click", handleJamListClick);
            jamVenueInput.addEventListener("change", () => {
              const selectedVenue = initialVenues.find(v => v.name === jamVenueInput.value);
              if (selectedVenue) jamMapLinkInput.value = selectedVenue.mapLink;
            });

            // Venue Management
            document.getElementById("manage-venues-btn").addEventListener("click", () => {
              venueManagementSection.style.display = venueManagementSection.style.display === "none" ? "block" : "none";
            });
            addVenueForm.addEventListener("submit", handleVenueFormSubmit);
            venueListAdmin.addEventListener("click", handleVenueListClick);
            
            // Site Config (Default Day, Cover Photo, Video)
            document.getElementById("save-default-day-btn").addEventListener("click", handleSaveDefaultDay);
            document.getElementById("edit-cover-photo-btn").addEventListener("click", () => editCoverPhotoForm.style.display = "block");
            document.getElementById("cancel-cover-photo-btn").addEventListener("click", () => editCoverPhotoForm.style.display = "none");
            editCoverPhotoForm.addEventListener("submit", handleCoverPhotoSubmit);
            document.getElementById("edit-featured-video-btn").addEventListener("click", () => editFeaturedVideoForm.style.display = "block");
            document.getElementById("cancel-featured-video-btn").addEventListener("click", () => editFeaturedVideoForm.style.display = "none");
            editFeaturedVideoForm.addEventListener("submit", handleFeaturedVideoSubmit);

            // Event Section
            document.getElementById("add-event-btn").addEventListener("click", () => addEventForm.style.display = 'block');
            document.getElementById("cancel-event-btn").addEventListener("click", () => addEventForm.style.display = 'none');
            addEventForm.addEventListener("submit", handleEventFormSubmit);
            eventList.addEventListener("click", handleEventListClick);

            // Gallery Section
            document.getElementById("add-photo-btn").addEventListener("click", () => addPhotoForm.style.display = 'block');
            document.getElementById("cancel-photo-btn").addEventListener("click", () => addPhotoForm.style.display = 'none');
            addPhotoForm.addEventListener("submit", handlePhotoFormSubmit);
            galleryGrid.addEventListener("click", handleGalleryGridClick);

            // Community Section
            document.getElementById("add-community-item-btn").addEventListener("click", () => showCommunityForm("add"));
            document.getElementById("cancel-community-btn").addEventListener("click", () => addCommunityForm.style.display = 'none');
            communityItemTypeInput.addEventListener("change", (e) => {
                const isCharity = e.target.value === "charity";
                charityFieldsWrapper.classList.toggle("hidden", !isCharity);
                communityHeadlineWrapper.classList.toggle("hidden", isCharity);
            });
            addCommunityForm.addEventListener("submit", handleCommunityFormSubmit);
            communitySwiperWrapper.addEventListener("click", handleCommunitySliderClick);

            // Date Tester
            document.getElementById("test-date-btn").addEventListener("click", () => {
                manageJamSchedule(testDateInput.value);
                renderJams();
            });
            document.getElementById("reset-date-btn").addEventListener("click", () => {
                testDateInput.value = "";
                manageJamSchedule();
                renderJams();
            });
        }
        
        // --- ASYNC EVENT HANDLERS (DB INTERACTIONS) ---
        async function handleJamFormSubmit(e) {
            e.preventDefault();
            const id = editJamIdInput.value;
            const selectedDate = jamDatePicker.selectedDates[0];
            if (!selectedDate || !jamVenueInput.value || !jamDayInput.value) {
                showModal("Please fill in all required jam fields.", "alert");
                return;
            }
            
            const jamData = {
                id: id || String(Date.now()),
                date: formatJamDateForStorage(selectedDate),
                day: jamDayInput.value,
                time: jamTimeInput.value,
                venue: jamVenueInput.value,
                mapLink: jamMapLinkInput.value.trim(),
                cancelled: id ? initialJams.find(j => j.id === id).cancelled : false,
                isRescheduled: rescheduledCheckbox.checked,
            };

            await setDoc(doc(db, "jams", jamData.id), jamData);
            await loadData();
            addJamForm.style.display = 'none';
        }
        
        async function handleJamListClick(e) {
            const target = e.target.closest("button");
            if (!target) return;
            const jamId = target.dataset.id;
            const jam = initialJams.find(j => j.id === jamId);
            if (!jam) return;
            
            if (target.classList.contains("edit-btn")) {
                showJamForm("edit", jam);
            } else if (target.classList.contains("delete-btn")) {
                showModal("Are you sure you want to permanently delete this jam?", "confirm", async () => {
                    await deleteDoc(doc(db, "jams", jamId));
                    await loadData();
                });
            } else if (target.classList.contains("cancel-btn") || target.classList.contains("reinstate-btn")) {
                const isCancelled = target.classList.contains("cancel-btn");
                const actionText = isCancelled ? "cancel" : "reinstate";
                showModal(`Are you sure you want to ${actionText} this jam?`, "confirm", async () => {
                    jam.cancelled = isCancelled;
                    await setDoc(doc(db, "jams", jam.id), jam);
                    await loadData();
                });
            }
        }

        async function handleVenueFormSubmit(e) {
            e.preventDefault();
            const name = newVenueNameInput.value.trim();
            const mapLink = newVenueMapLinkInput.value.trim();
            if (!name || !mapLink) return;
            const id = String(Date.now());
            await setDoc(doc(db, "venues", id), { id, name, mapLink });
            await loadData();
            addVenueForm.reset();
        }

        async function handleVenueListClick(e) {
            if (!e.target.classList.contains("delete-venue-btn")) return;
            const venueId = e.target.dataset.id;
            showModal("Are you sure you want to delete this venue?", "confirm", async () => {
                await deleteDoc(doc(db, "venues", venueId));
                await loadData();
            });
        }
        
        async function handleEventFormSubmit(e) {
            e.preventDefault();
            const eventData = {
                id: editEventIdInput.value || String(Date.now()),
                title: eventTitleInput.value.trim(),
                dates: eventDatesInput.value.trim(),
                description: eventDescriptionInput.value.trim(),
                time: eventTimeInput.value.trim(),
                mapLink: eventMapLinkInput.value.trim(),
            };
            if (!eventData.title || !eventData.dates || !eventData.description) {
                showModal("Please fill in all event fields.", "alert");
                return;
            }
            await setDoc(doc(db, "events", eventData.id), eventData);
            await loadData();
            addEventForm.style.display = 'none';
        }

        async function handleEventListClick(e) {
            const target = e.target.closest("button");
            if (!target) return;
            const eventId = target.dataset.id;
            const eventToEdit = initialEvents.find(ev => ev.id === eventId);
            if (!eventToEdit) return;

            if (target.classList.contains("edit-event-btn")) {
                addEventForm.style.display = 'block';
                eventFormTitle.textContent = "Edit Event";
                Object.keys(eventToEdit).forEach(key => {
                    const input = document.getElementById(`event-${key}`);
                    if (input) input.value = eventToEdit[key] || "";
                });
                editEventIdInput.value = eventId;
            } else if (target.classList.contains("delete-event-btn")) {
                showModal("Are you sure you want to delete this event?", "confirm", async () => {
                    await deleteDoc(doc(db, "events", eventId));
                    await loadData();
                });
            }
        }
        
        async function handlePhotoFormSubmit(e) {
            e.preventDefault();
            const id = String(Date.now());
            const photoData = {
                id,
                url: photoUrlInput.value.trim(),
                caption: photoCaptionInput.value.trim(),
            };
            if (!photoData.url || !photoData.caption) {
                showModal("Please provide both a URL and a caption.", "alert");
                return;
            }
            await setDoc(doc(db, "photos", id), photoData);
            await loadData();
            addPhotoForm.style.display = 'none';
        }

        async function handleGalleryGridClick(e) {
            const deleteBtn = e.target.closest(".delete-photo-btn");
            if (!deleteBtn) return;
            const photoId = deleteBtn.dataset.id;
            showModal("Are you sure you want to delete this photo?", "confirm", async () => {
                await deleteDoc(doc(db, "photos", photoId));
                await loadData();
            });
        }
        
        async function handleCommunityFormSubmit(e) {
            e.preventDefault();
            const itemData = {
                id: editCommunityIdInput.value || String(Date.now()),
                imageUrl: communityImageUrlInput.value.trim(),
                description: communityDescriptionInput.value.trim(),
                type: communityItemTypeInput.value,
            };

            if (!itemData.imageUrl || !itemData.description) {
                showModal("Please provide an Image URL and a Description.", "alert");
                return;
            }
            
            if (itemData.type === 'charity') {
                itemData.amountRaised = communityAmountInput.value.trim();
                itemData.charityName = communityCharityNameInput.value.trim();
                if (!itemData.amountRaised || !itemData.charityName) {
                    showModal("For charity items, please provide Amount Raised and Charity Name.", "alert");
                    return;
                }
            } else {
                itemData.headline = communityHeadlineInput.value.trim();
                 if (!itemData.headline) {
                    showModal("For community items, please provide a Headline.", "alert");
                    return;
                }
            }

            await setDoc(doc(db, "community", itemData.id), itemData);
            await loadData();
            addCommunityForm.style.display = 'none';
        }

        function showCommunityForm(mode = "add", item = null) {
            addCommunityForm.style.display = "block";
            addCommunityForm.reset();
            if (mode === "edit" && item) {
                communityFormTitle.textContent = "Edit Community/Charity Item";
                editCommunityIdInput.value = item.id;
                communityImageUrlInput.value = item.imageUrl;
                communityItemTypeInput.value = item.type;
                communityDescriptionInput.value = item.description;
                communityHeadlineInput.value = item.headline || "";
                communityAmountInput.value = item.amountRaised || "";
                communityCharityNameInput.value = item.charityName || "";
            } else {
                communityFormTitle.textContent = "Add New Community/Charity Item";
                editCommunityIdInput.value = "";
            }
            communityItemTypeInput.dispatchEvent(new Event("change"));
        }
        
        async function handleCommunitySliderClick(e) {
            const btn = e.target.closest("button");
            if (!btn) return;
            const itemId = btn.dataset.id;
            const item = initialCommunityItems.find(i => i.id === itemId);
            if (!item) return;

            if (btn.classList.contains("edit-community-btn")) {
                showCommunityForm("edit", item);
            } else if (btn.classList.contains("delete-community-btn")) {
                showModal("Are you sure you want to delete this item?", "confirm", async () => {
                    await deleteDoc(doc(db, "community", itemId));
                    await loadData();
                });
            }
        }
        
        async function handleSaveDefaultDay() {
            const newDefaultDay = defaultDaySelect.value;
            await setDoc(doc(db, "site_config", "main"), { defaultJamDay: newDefaultDay }, { merge: true });
            defaultJamDay = newDefaultDay;
            showModal("Default jam day updated successfully!", "alert", () => {
                manageJamSchedule();
                renderJams();
            });
        }
        
        async function handleCoverPhotoSubmit(e) {
            e.preventDefault();
            const newUrl = coverPhotoUrlInput.value.trim();
            if (!newUrl) return;
            await setDoc(doc(db, "site_config", "main"), { coverPhotoUrl: newUrl }, { merge: true });
            await loadData();
            editCoverPhotoForm.style.display = "none";
        }
        
        async function handleFeaturedVideoSubmit(e) {
            e.preventDefault();
            const newUrl = featuredVideoUrlInput.value.trim();
            if (!newUrl) return;
            await setDoc(doc(db, "site_config", "main"), { featuredVideoUrl: newUrl }, { merge: true });
            await loadData();
            editFeaturedVideoForm.style.display = "none";
        }

        // --- ADMIN & MODAL ---
        function toggleAdminMode(enable) {
            document.body.classList.toggle("admin-mode", enable);
            if (!enable) hideAllForms();
            // Re-render all sections to show/hide admin controls within them
            renderAll();
        }
        
function handleAdminClick(e) {
            e.preventDefault();
            if (document.body.classList.contains("admin-mode")) {
                sessionStorage.removeItem("gjc_isAdmin");
                toggleAdminMode(false);
            } else {
                showModal("Enter admin PIN:", "prompt", async (pin) => {
                    // Check if a PIN was actually entered
                    if (!pin) return; 

                    const isCorrect = await verifyPin(pin);
                    if (isCorrect) {
                        sessionStorage.setItem("gjc_isAdmin", "true");
                        toggleAdminMode(true);
                        document.getElementById("jams").scrollIntoView({ behavior: "smooth" });
                    } else {
                        // The verifyPin function will now show its own detailed error,
                        // but we still need a fallback for a simple "incorrect pin" result.
                        if (!document.getElementById('custom-modal').classList.contains('flex')) {
                           showModal("Incorrect PIN.", "alert");
                        }
                    }
                });
            }
        }

        async function verifyPin(pin) {
            const functionUrl = "https://script.google.com/macros/s/AKfycby34RunDhZjds7M7rUA5wP-m1M2uBv3UfJ6vpCxqKhMq36oGkHTIQ1BFF3-9kStGaTyAA/exec";
            try {
                const response = await fetch(`${functionUrl}?pin=${encodeURIComponent(pin)}&action=check`);

                // **THIS IS THE KEY FIX**
                // It now explicitly checks if the network request was successful.
                if (!response.ok) {
                    console.error("PIN verification request failed with status:", response.status);
                    showModal(`Error contacting verification server (Status: ${response.status}). Please try again later.`, "alert");
                    return false;
                }

                const result = await response.json();
                return result.success;

            } catch (error) {
                // This catch block handles cases where you can't connect at all (e.g., no internet).
                console.error("Error during PIN verification fetch:", error);
                showModal("Could not verify PIN. Please check your internet connection.", "alert");
                return false;
            }
        }
        
        function showModal(message, type = "alert", onConfirm = () => {}) {
            modalMessage.textContent = message;
            modalButtons.innerHTML = "";
            modalInput.classList.toggle("hidden", type !== "prompt");
            
            const cancelButton = document.createElement("button");
            cancelButton.textContent = "Cancel";
            cancelButton.className = "px-4 py-2 bg-stone-600 text-white rounded-md";
            cancelButton.onclick = () => modal.classList.remove('flex');
            
            const confirmButton = document.createElement("button");
            confirmButton.className = "px-4 py-2 bg-accent text-primary font-bold rounded-md";

            if (type === "alert") {
                confirmButton.textContent = "OK";
                confirmButton.onclick = () => { modal.classList.remove('flex'); onConfirm(); };
                modalButtons.appendChild(confirmButton);
            } else if (type === "confirm") {
                confirmButton.textContent = "Confirm";
                confirmButton.onclick = () => { modal.classList.remove('flex'); onConfirm(); };
                modalButtons.append(cancelButton, confirmButton);
            } else if (type === "prompt") {
                confirmButton.textContent = "Submit";
                confirmButton.onclick = () => { modal.classList.remove('flex'); onConfirm(modalInput.value); };
                modalButtons.append(cancelButton, confirmButton);
            }
            
            modal.classList.add("flex");
            if (type === "prompt") modalInput.focus();
        }

        // --- DATA LOADING & INITIAL RENDER ---
        function renderAll() {
            manageJamSchedule();
            renderJams();
            renderVenues();
            renderEvents();
            renderGallery();
            renderCommunitySlider();
        }

        async function loadData() {
            try {
                const [jamSnap, eventSnap, photoSnap, venueSnap, communitySnap, configDoc] = await Promise.all([
                    getDocs(collection(db, "jams")),
                    getDocs(collection(db, "events")),
                    getDocs(collection(db, "photos")),
                    getDocs(collection(db, "venues")),
                    getDocs(collection(db, "community")),
                    getDoc(doc(db, "site_config", "main")),
                ]);

                initialJams = jamSnap.docs.map(doc => doc.data());
                initialEvents = eventSnap.docs.map(doc => doc.data());
                initialPhotos = photoSnap.docs.map(doc => doc.data());
                initialVenues = venueSnap.docs.map(doc => doc.data());
                initialCommunityItems = communitySnap.docs.map(doc => doc.data());
                
                await seedDatabaseIfEmpty();

                if (configDoc.exists()) {
                    const configData = configDoc.data();
                    defaultJamDay = configData.defaultJamDay || "Saturday";
                    defaultDaySelect.value = defaultJamDay;
                    if (configData.coverPhotoUrl) coverPhotoElement.src = configData.coverPhotoUrl;
                    if (configData.featuredVideoUrl) {
                        const videoIdMatch = configData.featuredVideoUrl.match(/(?:v=|\/embed\/|\/)([\w-]{11})/);
                        if (videoIdMatch) featuredVideoPlayer.src = `https://www.youtube.com/embed/${videoIdMatch[1]}`;
                    }
                }
                dayNames.forEach(day => {
                    const option = document.createElement("option");
                    option.value = day;
                    option.textContent = day;
                    defaultDaySelect.appendChild(option);
                });
                defaultDaySelect.value = defaultJamDay;

                renderAll();

            } catch (error) {
                console.error("Error loading data: ", error);
                showModal("Could not load data from the database. Check console for details.", "alert");
            }
        }
        
        // --- App Entry Point ---
        initDatePickers();
        setupEventListeners();
        await loadData();
        if (sessionStorage.getItem("gjc_isAdmin") === "true") {
            toggleAdminMode(true);
        }
      });
    </script>
  </body>
</html>
